<!doctype html>
<html lang="zh"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta><title>Mysql基础命令及语法笔记 - 笔记</title><link rel="manifest" href="/manifest.json"><meta name="application-name" content="笔记"><meta name="msapplication-TileImage" content="/img/favicon.svg"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-title" content="笔记"><meta name="apple-mobile-web-app-status-bar-style" content="default"><meta name="description" content="show 命令 help show 查看允许的show语句  12345678show databasesshow tablesshow [full] columns from &amp;lt;table&amp;gt;show create database &amp;lt;name&amp;gt;show statusshow grantsshow errorsshow warnings"><meta property="og:type" content="blog"><meta property="og:title" content="Mysql基础命令及语法笔记"><meta property="og:url" content="https://www.chengyao.xyz/2021/07/05/Mysql%E5%9F%BA%E7%A1%80%E5%91%BD%E4%BB%A4%E5%8F%8A%E8%AF%AD%E6%B3%95%E7%AC%94%E8%AE%B0/"><meta property="og:site_name" content="笔记"><meta property="og:description" content="show 命令 help show 查看允许的show语句  12345678show databasesshow tablesshow [full] columns from &amp;lt;table&amp;gt;show create database &amp;lt;name&amp;gt;show statusshow grantsshow errorsshow warnings"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://www.chengyao.xyz/img/og_image.png"><meta property="article:published_time" content="2021-07-05T14:49:20.000Z"><meta property="article:modified_time" content="2022-10-02T12:47:41.686Z"><meta property="article:author" content="CY"><meta property="twitter:card" content="summary"><meta property="twitter:image:src" content="https://www.chengyao.xyz/img/og_image.png"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://www.chengyao.xyz/2021/07/05/Mysql%E5%9F%BA%E7%A1%80%E5%91%BD%E4%BB%A4%E5%8F%8A%E8%AF%AD%E6%B3%95%E7%AC%94%E8%AE%B0/"},"headline":"Mysql基础命令及语法笔记","image":["https://www.chengyao.xyz/img/og_image.png"],"datePublished":"2021-07-05T14:49:20.000Z","dateModified":"2022-10-02T12:47:41.686Z","author":{"@type":"Person","name":"CY"},"publisher":{"@type":"Organization","name":"笔记","logo":{"@type":"ImageObject","url":"https://www.chengyao.xyz/images/avatar.jpg"}},"description":"show 命令 help show 查看允许的show语句  12345678show databasesshow tablesshow [full] columns from &lt;table&gt;show create database &lt;name&gt;show statusshow grantsshow errorsshow warnings"}</script><link rel="canonical" href="https://www.chengyao.xyz/2021/07/05/Mysql%E5%9F%BA%E7%A1%80%E5%91%BD%E4%BB%A4%E5%8F%8A%E8%AF%AD%E6%B3%95%E7%AC%94%E8%AE%B0/"><link rel="icon" href="/img/favicon.svg"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v6.0.0/css/all.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@9.12.0/styles/atom-one-light.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;600&amp;family=Source+Code+Pro"><link rel="stylesheet" href="/css/default.css"><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><!--!--><!--!--><!--!--><!--!--><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/css/justifiedGallery.min.css"><!--!--><!--!--><style>.pace{-webkit-pointer-events:none;pointer-events:none;-webkit-user-select:none;-moz-user-select:none;user-select:none}.pace-inactive{display:none}.pace .pace-progress{background:#3273dc;position:fixed;z-index:2000;top:0;right:100%;width:100%;height:2px}</style><script src="https://cdn.jsdelivr.net/npm/pace-js@1.2.4/pace.min.js"></script><!--!--><!--!--><!-- hexo injector head_end start --><script>
  (function () {
      function switchTab() {
          if (!location.hash) {
            return;
          }

          const $tabMenu = document.querySelector(`a[href="${location.hash}"]`);
          if (!$tabMenu) {
            return;
          }

          const $tabMenuContainer = $tabMenu.parentElement.parentElement;
          Array.from($tabMenuContainer.children).forEach($menu => $menu.classList.remove('is-active'));
          Array.from($tabMenuContainer.querySelectorAll('a'))
              .map($menu => document.getElementById($menu.getAttribute("href").substring(1)))
              .forEach($content => $content.classList.add('is-hidden'));

          if ($tabMenu) {
              $tabMenu.parentElement.classList.add('is-active');
          }
          const $activeTab = document.querySelector(location.hash);
          if ($activeTab) {
              $activeTab.classList.remove('is-hidden');
          }
      }
      switchTab();
      window.addEventListener('hashchange', switchTab, false);
  })();
  </script><!-- hexo injector head_end end --><meta name="generator" content="Hexo 6.3.0"></head><body class="is-3-column"><nav class="navbar navbar-main"><div class="container navbar-container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/"><img src="/images/avatar.jpg" alt="笔记" height="28"></a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/">主页</a><a class="navbar-item" href="/archives">归档</a><a class="navbar-item" href="/categories">分类</a><a class="navbar-item" href="/tags">标签</a><a class="navbar-item" href="/about">关于</a></div><div class="navbar-end"><a class="navbar-item" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/tab-engineer"><i class="fab fa-github"></i></a><a class="navbar-item search" title="搜索" href="javascript:;"><i class="fas fa-search"></i></a></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-8-tablet is-8-desktop is-6-widescreen"><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2021-07-05T14:49:20.000Z" title="2021/7/5 下午10:49:20">2021-07-05</time>发表</span><span class="level-item"><time dateTime="2022-10-02T12:47:41.686Z" title="2022/10/2 下午8:47:41">2022-10-02</time>更新</span><span class="level-item">1 小时读完 (大约11210个字)</span></div></div><h1 class="title is-3 is-size-4-mobile">Mysql基础命令及语法笔记</h1><div class="content"><h1 id="show-命令"><a href="#show-命令" class="headerlink" title="show 命令"></a>show 命令</h1><blockquote>
<p>help show 查看允许的show语句</p>
</blockquote>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">show</span> databases</span><br><span class="line"><span class="keyword">show</span> tables</span><br><span class="line"><span class="keyword">show</span> [<span class="keyword">full</span>] columns <span class="keyword">from</span> <span class="operator">&lt;</span><span class="keyword">table</span><span class="operator">&gt;</span></span><br><span class="line"><span class="keyword">show</span> <span class="keyword">create</span> database <span class="operator">&lt;</span>name<span class="operator">&gt;</span></span><br><span class="line"><span class="keyword">show</span> status</span><br><span class="line"><span class="keyword">show</span> grants</span><br><span class="line"><span class="keyword">show</span> errors</span><br><span class="line"><span class="keyword">show</span> warnings</span><br></pre></td></tr></table></figure>

<span id="more"></span>

<h1 id="set-names"><a href="#set-names" class="headerlink" title="set names"></a>set names</h1><p>设置编码</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">set names &#x27;utf8&#x27;;</span><br></pre></td></tr></table></figure>

<h1 id="select"><a href="#select" class="headerlink" title="select"></a>select</h1><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="keyword">distinct</span> <span class="operator">&lt;</span><span class="keyword">column</span><span class="operator">&gt;</span> <span class="keyword">from</span> <span class="operator">&lt;</span><span class="keyword">table</span><span class="operator">&gt;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>对于order by , <code>A</code> 和 <code>a</code> 不一定相同（在mysql中默认相同【字典排序】），取决于数据库怎么设计，通常可以改变这种行为。</p>
</blockquote>
<blockquote>
<p>对于没有排序的语句，返回的结果集的顺序没有特殊意义，又可能按照插入表的顺序，也有可能不是，只要返回总数正确，就是正常的。</p>
</blockquote>
<h2 id="正则"><a href="#正则" class="headerlink" title="正则"></a>正则</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> users <span class="keyword">WHERE</span> name REGEXP <span class="type">BINARY</span> <span class="string">&#x27;^cheng.*g$&#x27;</span> <span class="comment">--使用BINARY来区分大小写</span></span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> information <span class="keyword">WHERE</span> salary REGEXP <span class="string">&#x27;1000|2000&#x27;</span> <span class="comment">--OR匹配</span></span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> users <span class="keyword">WHERE</span> name REGEXT <span class="string">&#x27;[cz]ong&#x27;</span> <span class="comment">-- 单一字符，会匹配cong / zong； 可以使用否定 例如：[^cz]</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>其他支持的正则 [0-9], \\-（特殊字符）-, 也可以用来引用元字符，例如\\f (换页)， \\n （换行），\\r （换行）, \\t （制表）, \\v （纵向制表），\\ （反斜线），多数正则表达式使用单个反斜线转义特殊字符，mysql要求使用两个，一个由mysql解析，另外一个由正则表达式库解析。</p>
</blockquote>
<p>like 也支持binary来区分大小写 <code>like binary</code>, 大小写主要取决于表的校对规则collect</p>
<h3 id="字符类（character-class）"><a href="#字符类（character-class）" class="headerlink" title="字符类（character class）"></a>字符类（character class）</h3><table>
<thead>
<tr>
<th>类</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>[:alnum:]</td>
<td>任意字母和数字.(同[ a-zA-Z0-9])</td>
</tr>
<tr>
<td>[:alpha:]</td>
<td>任意字符（同[ a-zA-Z])</td>
</tr>
<tr>
<td>[:blank:]</td>
<td>空格和制表（同[ \lt])</td>
</tr>
<tr>
<td>[:cntrl:]</td>
<td>ASCII控制字符（ASCII 0到31和127)</td>
</tr>
<tr>
<td>[:digit:]</td>
<td>任意数字（同[0-9])</td>
</tr>
<tr>
<td>[:graph:]</td>
<td>与[ :print : ]相同，但不包括空格</td>
</tr>
<tr>
<td>[:lower:]</td>
<td>任意小写字母(同[ a-z])</td>
</tr>
<tr>
<td>[:print:]</td>
<td>任意可打印字符</td>
</tr>
<tr>
<td>[:punct:]</td>
<td>既不在[ :alnum: ]又不在[ :cntrl: ]中的任意字符</td>
</tr>
<tr>
<td>[:space:]</td>
<td>包括空格在内的任意空白字符（同[ \lf\ln \lrlltllv])</td>
</tr>
<tr>
<td>[:upper:]</td>
<td>任意大写字母(同[A-Z])</td>
</tr>
<tr>
<td>[:xdigit:]</td>
<td>任意十六进制数字（同[ a-fA-FO-9])</td>
</tr>
</tbody></table>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> contracts <span class="keyword">where</span> amount regexp <span class="string">&#x27;[[:digit:]]&#123;2,4&#125;&#x27;</span></span><br><span class="line"><span class="comment">-- 匹配2到四位数字</span></span><br></pre></td></tr></table></figure>

<h3 id="匹配多个实例"><a href="#匹配多个实例" class="headerlink" title="匹配多个实例"></a>匹配多个实例</h3><p>支持<code>*</code>,<code>+</code>, <code>?</code>, <code>&#123;n&#125;</code>, <code>&#123;n,&#125;</code>, <code>&#123;n,m&#125;</code> 其中m不能大于255 （mysql8测试可以输入大于255的数字，但是有没有效果没有测试）</p>
<h3 id="元字符"><a href="#元字符" class="headerlink" title="元字符"></a>元字符</h3><table>
<thead>
<tr>
<th>元字符</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>^</td>
<td>文本的开始</td>
</tr>
<tr>
<td>$</td>
<td>文本的结尾</td>
</tr>
<tr>
<td>[[:&lt;:]]</td>
<td>词的开始</td>
</tr>
<tr>
<td>[[:&gt;:]]</td>
<td>词的结尾</td>
</tr>
</tbody></table>
<blockquote>
<p>匹配词的边界，兼容perl的正则表达式通常使用\b单词边界 或者\B 非单词边界</p>
</blockquote>
<p>使REGEXP起类似LIKE的作用， LIKE和REGEXP的不同在于、LIKE匹配整个串而REGEXP匹配子串。利用定位符,通过用^开始每个表达式，用$结束每个表达式可以使REGEXP的作用与LIKE一样。</p>
<blockquote>
<p>简单的正则表达式测试可以在不使用数据库表的情况下用SELECT来测试正则表达式。 REGEXP检查总是返回0(没有匹配）或1(匹配）。可以用带文字串的REGEXP来测试表达式，并试验它们。相应的语法如下:</p>
</blockquote>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="string">&#x27;hello&#x27;</span> REGEXP <span class="string">&#x27;[0-9]&#x27;</span>;</span><br></pre></td></tr></table></figure>

<h2 id="计算字段"><a href="#计算字段" class="headerlink" title="计算字段"></a>计算字段</h2><h3 id="拼接（concatenate）字段或者字符串"><a href="#拼接（concatenate）字段或者字符串" class="headerlink" title="拼接（concatenate）字段或者字符串"></a>拼接（concatenate）字段或者字符串</h3><blockquote>
<p>多数数据库采用<code>||</code>或者<code>+</code> 来拼接，而Mysql使用concat() 函数拼接。</p>
</blockquote>
<h3 id="删除多余空格"><a href="#删除多余空格" class="headerlink" title="删除多余空格"></a>删除多余空格</h3><p><code>rtrim()</code> <code>ltrim()</code> <code>trim()</code></p>
<p><code>AS</code> 别名，可以用来创建一个计算字段，当列名不符合规定的字符例如包含空格的时候可以使用别名代替，在原名易混淆时候扩充它。别名也称作<code>导出列（derivid column）</code></p>
<h2 id="函数"><a href="#函数" class="headerlink" title="函数"></a>函数</h2><h3 id="文本处理函数"><a href="#文本处理函数" class="headerlink" title="文本处理函数"></a>文本处理函数</h3><table>
<thead>
<tr>
<th>函数</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>LEFT(Str,length)</td>
<td>返回串左边的字符</td>
</tr>
<tr>
<td>Length()</td>
<td>返回串的长度</td>
</tr>
<tr>
<td>Locate()</td>
<td>找出一个串的子串</td>
</tr>
<tr>
<td>Lower()</td>
<td>将串转为小写</td>
</tr>
<tr>
<td>Ltrim()</td>
<td>去掉左边的空格</td>
</tr>
<tr>
<td>Right()</td>
<td>返回串右边的字符</td>
</tr>
<tr>
<td>Rtrim()</td>
<td>去掉右边空格</td>
</tr>
<tr>
<td>Soundex()</td>
<td>发音接近</td>
</tr>
<tr>
<td>SubString()</td>
<td>返回子串的字符</td>
</tr>
<tr>
<td>Upper()</td>
<td>将串转为大写</td>
</tr>
<tr>
<td>LOCATE(substr,str)</td>
<td>寻找子串位置，返回数字，0表示没有找到</td>
</tr>
<tr>
<td>LOCATE(substr,str,pos)</td>
<td></td>
</tr>
<tr>
<td>POSITION(substr IN str)</td>
<td></td>
</tr>
<tr>
<td>INSTR(str,substr)</td>
<td></td>
</tr>
<tr>
<td>REVERSE(Str)</td>
<td>翻转</td>
</tr>
</tbody></table>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> </span><br><span class="line"><span class="keyword">FROM</span> party_course_study</span><br><span class="line"><span class="keyword">WHERE</span> LOCATE(findCode, <span class="string">&#x27;00001&#x27;</span>) <span class="operator">&gt;</span><span class="number">0</span></span><br><span class="line"> </span><br><span class="line"><span class="operator">/</span><span class="operator">/</span> 注：Mybatis使用场景，需要加 <span class="operator">&lt;</span><span class="operator">!</span>[CDATA[ ]]<span class="operator">&gt;</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> </span><br><span class="line"><span class="keyword">FROM</span> party_course_study</span><br><span class="line"><span class="keyword">WHERE</span> <span class="operator">&lt;</span><span class="operator">!</span>[CDATA[ LOCATE(findCode, <span class="string">&#x27;00001&#x27;</span>) <span class="operator">&gt;</span> <span class="number">0</span> ]]<span class="operator">&gt;</span></span><br></pre></td></tr></table></figure>


<blockquote>
<p>表中的SOUNDEX需要做进一步的解释。SOUNDEX是一个将任何文本串转换为描述其语音表示的字母数字模式的算法。SOUNDEX考虑了类似的发音字符和音节，使得能对串进行发音比较而不是字母比较。虽然SOUNDEX不是SQL概念，但MySQL（就像多数DBMS一样）都提供对SOUNDEX的支持。</p>
</blockquote>
<h3 id="日期和时间处理函数"><a href="#日期和时间处理函数" class="headerlink" title="日期和时间处理函数"></a>日期和时间处理函数</h3><table>
<thead>
<tr>
<th>函数</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>AddDate()</td>
<td>增加一个日期（天、周等）</td>
</tr>
<tr>
<td>AddTime()</td>
<td>增加一个时间（时、分等）</td>
</tr>
<tr>
<td>CurDate()</td>
<td>返回当前日期</td>
</tr>
<tr>
<td>CurTime ()</td>
<td>返回当前时间</td>
</tr>
<tr>
<td>Date()</td>
<td>返回日期时间的日期部分</td>
</tr>
<tr>
<td>DateDiff ()</td>
<td>计算两个日期之差</td>
</tr>
<tr>
<td>Date_Add()</td>
<td>高度灵活的日期运算函数</td>
</tr>
<tr>
<td>Date Format ()</td>
<td>返回一个格式化的日期或时间串</td>
</tr>
<tr>
<td>Day()</td>
<td>返回一个日期的天数部分</td>
</tr>
<tr>
<td>DayOfWeek()</td>
<td>对千一个日期， 返回对应的星期几</td>
</tr>
<tr>
<td>Hour()</td>
<td>返回一个时间的小时部分</td>
</tr>
<tr>
<td>minute()</td>
<td>返回一个时间的分钟部分</td>
</tr>
<tr>
<td>Month ()</td>
<td>返回一个日期的月份部分</td>
</tr>
<tr>
<td>Now()</td>
<td>返回当前日期和时间</td>
</tr>
<tr>
<td>Second()</td>
<td>返回一个时间的秒部分</td>
</tr>
<tr>
<td>Time ()</td>
<td>返回一个日期时间的时间部分</td>
</tr>
<tr>
<td>Year()</td>
<td>返回一个日期的年份部分</td>
</tr>
<tr>
<td>DATE_FORMAT(CURDATE(),’%Y%m’)</td>
<td>结果为当前年和月</td>
</tr>
<tr>
<td>CURRENT_TIMESTAM</td>
<td>当前时间戳</td>
</tr>
<tr>
<td>CURRENT_TIME</td>
<td>当前时间</td>
</tr>
<tr>
<td>CURRENT_DATE</td>
<td>当前日期</td>
</tr>
</tbody></table>
<p>mysql查询今天、昨天、本周、本月、上一月 、今年数据</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line">--今天</span><br><span class="line"></span><br><span class="line">select * from 表名 where to_days(时间字段名) = to_days(now());</span><br><span class="line"></span><br><span class="line">--昨天</span><br><span class="line"></span><br><span class="line">SELECT * FROM 表名 WHERE TO_DAYS( NOW( ) ) - TO_DAYS( 时间字段名) &amp;lt;= 1</span><br><span class="line"></span><br><span class="line">--本周</span><br><span class="line"></span><br><span class="line">SELECT * FROM  表名 WHERE YEARWEEK( date_format(  时间字段名,&#x27;%Y-%m-%d&#x27; ) ) = YEARWEEK( now() ) ;</span><br><span class="line"></span><br><span class="line">--本月</span><br><span class="line"></span><br><span class="line">SELECT * FROM  表名 WHERE DATE_FORMAT( 时间字段名, &#x27;%Y%m&#x27; ) = DATE_FORMAT( CURDATE( ) ,&#x27;%Y%m&#x27; ) </span><br><span class="line"></span><br><span class="line">--上一个月</span><br><span class="line"></span><br><span class="line">SELECT * FROM  表名 WHERE PERIOD_DIFF(date_format(now(),&#x27;%Y%m&#x27;),date_format(时间字段名,&#x27;%Y%m&#x27;) =1</span><br><span class="line"></span><br><span class="line">--本年</span><br><span class="line"></span><br><span class="line">SELECT * FROM 表名 WHERE YEAR(  时间字段名 ) = YEAR( NOW( ) ) </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">--上一月</span><br><span class="line"></span><br><span class="line">SELECT * FROM 表名 WHERE PERIOD_DIFF( date_format( now( ) , &#x27;%Y%m&#x27; ) , date_format( 时间字段名, &#x27;%Y%m&#x27; ) ) =1</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">--查询本季度数据</span><br><span class="line">select * from `ht_invoice_information` where QUARTER(create_date)=QUARTER(now());</span><br><span class="line">--查询上季度数据</span><br><span class="line">select * from `ht_invoice_information` where QUARTER(create_date)=QUARTER(DATE_SUB(now(),interval 1 QUARTER));</span><br><span class="line">--查询本年数据</span><br><span class="line">select * from `ht_invoice_information` where YEAR(create_date)=YEAR(NOW());</span><br><span class="line">--查询上年数据</span><br><span class="line">select * from `ht_invoice_information` where year(create_date)=year(date_sub(now(),interval 1 year));</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">--查询当前这周的数据 </span><br><span class="line">SELECT name,submittime FROM enterprise WHERE YEARWEEK(date_format(submittime,&#x27;%Y-%m-%d&#x27;)) = YEARWEEK(now());</span><br><span class="line"></span><br><span class="line">--查询上周的数据</span><br><span class="line">SELECT name,submittime FROM enterprise WHERE YEARWEEK(date_format(submittime,&#x27;%Y-%m-%d&#x27;)) = YEARWEEK(now())-1;</span><br><span class="line"></span><br><span class="line">--查询当前月份的数据</span><br><span class="line">select name,submittime from enterprise   where date_format(submittime,&#x27;%Y-%m&#x27;)=date_format(now(),&#x27;%Y-%m&#x27;)</span><br><span class="line"></span><br><span class="line">--查询距离当前现在6个月的数据</span><br><span class="line">select name,submittime from enterprise where submittime between date_sub(now(),interval 6 month) and now();</span><br><span class="line"></span><br><span class="line">--查询上个月的数据</span><br><span class="line">select name,submittime from enterprise   where date_format(submittime,&#x27;%Y-%m&#x27;)=date_format(DATE_SUB(curdate(), INTERVAL 1 MONTH),&#x27;%Y-%m&#x27;)</span><br><span class="line"></span><br><span class="line">select * from ` user ` where DATE_FORMAT(pudate, &#x27; %Y%m &#x27; ) = DATE_FORMAT(CURDATE(), &#x27; %Y%m &#x27; ) ;</span><br><span class="line"></span><br><span class="line">select * from user where WEEKOFYEAR(FROM_UNIXTIME(pudate,&#x27;%y-%m-%d&#x27;)) = WEEKOFYEAR(now())</span><br><span class="line"></span><br><span class="line">select * </span><br><span class="line">from user </span><br><span class="line">where MONTH (FROM_UNIXTIME(pudate, &#x27; %y-%m-%d &#x27; )) = MONTH (now())</span><br><span class="line"></span><br><span class="line">select * </span><br><span class="line">from [ user ] </span><br><span class="line">where YEAR (FROM_UNIXTIME(pudate, &#x27; %y-%m-%d &#x27; )) = YEAR (now())</span><br><span class="line">and MONTH (FROM_UNIXTIME(pudate, &#x27; %y-%m-%d &#x27; )) = MONTH (now())</span><br><span class="line"></span><br><span class="line">select * </span><br><span class="line">from [ user ] </span><br><span class="line">where pudate between 上月最后一天</span><br><span class="line">and 下月第一天</span><br><span class="line"></span><br><span class="line">where   date(regdate)   =   curdate();</span><br><span class="line"></span><br><span class="line">select   *   from   test   where   year(regdate)=year(now())   and   month(regdate)=month(now())   and   day(regdate)=day(now())</span><br><span class="line"></span><br><span class="line">SELECT date( c_instime ) ,curdate( )</span><br><span class="line">FROM `t_score`</span><br><span class="line">WHERE 1</span><br><span class="line">LIMIT 0 , 30</span><br></pre></td></tr></table></figure>

<h3 id="数值处理函数"><a href="#数值处理函数" class="headerlink" title="数值处理函数"></a>数值处理函数</h3><table>
<thead>
<tr>
<th>函数</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>Abs ()</td>
<td>返回一个数的绝对值</td>
</tr>
<tr>
<td>Cos ()</td>
<td>返回一个角度的余弦</td>
</tr>
<tr>
<td>Exp ()</td>
<td>返回一个数的指数值</td>
</tr>
<tr>
<td>Mod ()</td>
<td>返回除操作的余数</td>
</tr>
<tr>
<td>Pi（）</td>
<td>返回圆周率</td>
</tr>
<tr>
<td>Rand ()</td>
<td>返回一个随机数</td>
</tr>
<tr>
<td>Sin ()</td>
<td>返回一个角度的正弦</td>
</tr>
<tr>
<td>Sqrt()</td>
<td>返回一个数的平方根</td>
</tr>
<tr>
<td>Tan ()</td>
<td>返回一个角度的正切</td>
</tr>
</tbody></table>
<h2 id="聚集函数"><a href="#聚集函数" class="headerlink" title="聚集函数"></a>聚集函数</h2><table>
<thead>
<tr>
<th></th>
<th></th>
</tr>
</thead>
<tbody><tr>
<td>AVG()</td>
<td>返回某列的平均值</td>
</tr>
<tr>
<td>COUNT()</td>
<td>返回某列的行数</td>
</tr>
<tr>
<td>MAX()</td>
<td>返回某列的最大值</td>
</tr>
<tr>
<td>MIN()</td>
<td>返回某列的最小值</td>
</tr>
<tr>
<td>SUM()</td>
<td>返回某列值之和</td>
</tr>
</tbody></table>
<blockquote>
<p>不可以使用distinct <em>, count(</em>) 包含null，count(字段) 不包含null，；利用标准运算符，所有的聚集函数都可以执行多个列的运算</p>
</blockquote>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="built_in">count</span>(<span class="keyword">distinct</span> cid) <span class="keyword">from</span> notes;</span><br></pre></td></tr></table></figure>

<p>聚合函数可以聚合多个列的计算值，例如</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="built_in">sum</span>(price <span class="operator">*</span> stock) <span class="keyword">from</span> products;</span><br></pre></td></tr></table></figure>

<h2 id="concat系列函数"><a href="#concat系列函数" class="headerlink" title="concat系列函数"></a>concat系列函数</h2><h3 id="concat"><a href="#concat" class="headerlink" title="concat"></a>concat</h3><p><strong>mysql</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select concat(id, name) as id_and_name from users;</span><br></pre></td></tr></table></figure>

<p>返回两个字段拼接的值，如果有一个字段的值为null，则返回null</p>
<p><strong>oracle, psql</strong></p>
<p>可以使用<code>||</code>来分割，例如</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select id || name as id_and_name from users;</span><br></pre></td></tr></table></figure>

<p>好像是上面这么写的，好久没用了。</p>
<h3 id="concat-ws"><a href="#concat-ws" class="headerlink" title="concat_ws"></a>concat_ws</h3><blockquote>
<p>concat with separator, 使用分隔符分割</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select concat_ws(&#x27;,&#x27;, id, name) as id_and_name from users;</span><br></pre></td></tr></table></figure>

<p>返回结果例如，分隔符如果为null则返回null</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">id = 1, name = 2</span><br><span class="line">id_and_name 1,2</span><br></pre></td></tr></table></figure>

<h3 id="group-concat"><a href="#group-concat" class="headerlink" title="group_concat"></a>group_concat</h3><ul>
<li>功能：将<code>group by</code>产生的同一个分组中的值连接起来，返回一个字符串结果。</li>
<li>语法：<code>group_concat( [distinct] 要连接的字段 [order by 排序字段 asc/desc ] [separator &#39;分隔符&#39;])</code></li>
</ul>
<blockquote>
<p>在有group by的查询语句中，select指定的字段要么就包含在group by语句的后面，作为分组的依据，要么就包含在聚合函数中</p>
</blockquote>
<p>例如，查询相同姓名中年龄最小的用户</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select name, min(age) from users group by name;</span><br></pre></td></tr></table></figure>

<p>如果要查出所有</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select name, age from users order by age;</span><br></pre></td></tr></table></figure>

<p>则name可能重复，可以使用group_concat</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select name, group_concat(age) from users group by name; </span><br></pre></td></tr></table></figure>

<h2 id="分组"><a href="#分组" class="headerlink" title="分组"></a>分组</h2><p><code>group by</code> 必须出现在<code>where</code>之后<code>order by</code>之前</p>
<p>使用<code>with rollup</code> 可以获取分组汇总级别</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="built_in">count</span>(id), id <span class="keyword">from</span> users <span class="keyword">group</span> <span class="keyword">by</span> id <span class="keyword">with</span> <span class="keyword">rollup</span>;</span><br></pre></td></tr></table></figure>

<p>我们经常发现用GROUP BY分组的数据确实是以分组顺序输出的。但情况并不总是这样，它并不是SQL规范所要求的。此外，用户也可能会要求以不同于分组的顺序排序。仅因为你以某种方式分组数据（获得特定的分组聚集值)，并不表示你需要以相同的方式排序输出。应该提供明确的ORDER BY子句，即使其效果等同于GROUP BY子句也是如此。</p>
<blockquote>
<p>不要忘记ORDER BY一般在使用GROUP BY子句时，应该也给出ORDER BY子句。这是保证数据正确排序的唯一方法。千万不要仅依赖GROUP BY排序数据。</p>
</blockquote>
<h1 id="排序"><a href="#排序" class="headerlink" title="排序"></a>排序</h1><h2 id="随机排序"><a href="#随机排序" class="headerlink" title="随机排序"></a>随机排序</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">order by rand()</span><br></pre></td></tr></table></figure>

<h2 id="取消排序"><a href="#取消排序" class="headerlink" title="取消排序"></a>取消排序</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">order by null </span><br></pre></td></tr></table></figure>

<h2 id="自定义排序"><a href="#自定义排序" class="headerlink" title="自定义排序"></a>自定义排序</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">order by field(id, 1,3,4)</span><br></pre></td></tr></table></figure>

<p>根据id自定义排序，如果id是null或者不存在于后面的列表中则排序为0，否则按照后面给定的排序进行排序</p>
<h1 id="SQL子句顺序"><a href="#SQL子句顺序" class="headerlink" title="SQL子句顺序"></a>SQL子句顺序</h1><table>
<thead>
<tr>
<th>子句</th>
<th>说明</th>
<th>是否必须使用</th>
</tr>
</thead>
<tbody><tr>
<td>SELECT</td>
<td>要返回的列或表达式</td>
<td>是</td>
</tr>
<tr>
<td>FROM</td>
<td>从中检索数据的表</td>
<td>仅在从表选择数据时使用</td>
</tr>
<tr>
<td>WHERE</td>
<td>行级过滤</td>
<td>否</td>
</tr>
<tr>
<td>GROUP BY</td>
<td>分组说明</td>
<td>仅在按组计算聚集时使用</td>
</tr>
<tr>
<td>HAVING</td>
<td>组级过滤</td>
<td>否</td>
</tr>
<tr>
<td>ORDER BY</td>
<td>输出排序顺序</td>
<td>否</td>
</tr>
<tr>
<td>LIMIT</td>
<td>要检索的行数</td>
<td>否</td>
</tr>
</tbody></table>
<h1 id="子查询"><a href="#子查询" class="headerlink" title="子查询"></a>子查询</h1><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> maker <span class="keyword">where</span> country_id <span class="keyword">in</span> (<span class="keyword">select</span> country_id <span class="keyword">from</span> country);</span><br></pre></td></tr></table></figure>

<h1 id="联表"><a href="#联表" class="headerlink" title="联表"></a>联表</h1><p>自联结<br>内联<br>外联【左，右】<br>full join</p>
<h1 id="组合查询"><a href="#组合查询" class="headerlink" title="组合查询"></a>组合查询</h1><p>union 会去除重复行<br>union all 不会去除重复行</p>
<h1 id="索引"><a href="#索引" class="headerlink" title="索引"></a>索引</h1><p>禁用、启用索引</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> users disable keys; <span class="comment">--禁用</span></span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> users enable keys; <span class="comment">--启用</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>在批量插入数据之前禁用索引，插入完成后启用索引</p>
</blockquote>
<h2 id="创建索引"><a href="#创建索引" class="headerlink" title="创建索引"></a>创建索引</h2><h3 id="添加PRIMARY-KEY（主键索引）"><a href="#添加PRIMARY-KEY（主键索引）" class="headerlink" title="添加PRIMARY KEY（主键索引）"></a>添加PRIMARY KEY（主键索引）</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ALTER TABLE `table_name` ADD PRIMARY KEY ( `column` ) </span><br></pre></td></tr></table></figure>

<h3 id="添加UNIQUE-唯一索引"><a href="#添加UNIQUE-唯一索引" class="headerlink" title="添加UNIQUE(唯一索引)"></a>添加UNIQUE(唯一索引)</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ALTER TABLE `table_name` ADD UNIQUE ( `column` ) </span><br></pre></td></tr></table></figure>

<h3 id="添加INDEX-普通索引"><a href="#添加INDEX-普通索引" class="headerlink" title="添加INDEX(普通索引)"></a>添加INDEX(普通索引)</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ALTER TABLE `table_name` ADD INDEX index_name ( `column` ) </span><br></pre></td></tr></table></figure>

<h3 id="添加FULLTEXT-全文索引"><a href="#添加FULLTEXT-全文索引" class="headerlink" title="添加FULLTEXT(全文索引)"></a>添加FULLTEXT(全文索引)</h3><h4 id="建表时建立"><a href="#建表时建立" class="headerlink" title="建表时建立"></a>建表时建立</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> article ( </span><br><span class="line">    id <span class="type">INT</span> AUTO_INCREMENT <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">PRIMARY</span> KEY, </span><br><span class="line">    title <span class="type">VARCHAR</span>(<span class="number">200</span>), </span><br><span class="line">    body TEXT, </span><br><span class="line">    FULLTEXT(title, body) </span><br><span class="line">) TYPE<span class="operator">=</span>MYISAM; </span><br></pre></td></tr></table></figure>

<h4 id="修改"><a href="#修改" class="headerlink" title="修改"></a>修改</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> `table_name` <span class="keyword">ADD</span> FULLTEXT INDEX index_name( `<span class="keyword">column</span>`, `column2`); </span><br></pre></td></tr></table></figure>

<h4 id="直接添加"><a href="#直接添加" class="headerlink" title="直接添加"></a>直接添加</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> FULLTEXT INDEX index_name(`<span class="keyword">column</span>`) <span class="keyword">on</span> `table_name`;</span><br></pre></td></tr></table></figure>

<h3 id="添加多列索引"><a href="#添加多列索引" class="headerlink" title="添加多列索引"></a>添加多列索引</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> `table_name` <span class="keyword">ADD</span> INDEX index_name ( `column1`, `column2`, `column3` )</span><br></pre></td></tr></table></figure>

<h2 id="修改索引"><a href="#修改索引" class="headerlink" title="修改索引"></a>修改索引</h2><p>mysql中没有真正意义上的修改索引，只有先删除之后在创建新的索引才可以达到修改的目的，原因是mysql在创建索引时会对字段建立关系长度等，只有删除之后创建新的索引才能创建新的关系保证索引的正确性；</p>
<p>如：将login_name_index索引修改为单唯一索引；</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">DROP INDEX login_name_index ON `user`; </span><br><span class="line">ALTER TABLE `user` ADD UNIQUE login_name_index ( `login_name` );</span><br></pre></td></tr></table></figure>

<h2 id="删除索引"><a href="#删除索引" class="headerlink" title="删除索引"></a>删除索引</h2><p>格式：<code>DROP INDEX</code> 索引名称 <code>ON</code> 表名;</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DROP</span> INDEX login_name_index <span class="keyword">ON</span> <span class="string">&#x27;user&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> `table_name` <span class="keyword">DROP</span> INDEX <span class="string">&#x27;index_name&#x27;</span>;</span><br></pre></td></tr></table></figure>

<h2 id="查询索引"><a href="#查询索引" class="headerlink" title="查询索引"></a>查询索引</h2><p>格式：SHOW INDEX FROM 表名;</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SHOW INDEX FROM `user`;</span><br></pre></td></tr></table></figure>


<h2 id="全文索引"><a href="#全文索引" class="headerlink" title="全文索引"></a>全文索引</h2><p>全文本搜索时，MySQL不需要分别查看每个行，不需要分别分析和处理每个词。MySQL创建指定列中各词的-一个索引，搜索可以针对这些词进行。这样，MySQL可以快速有效地决定哪些词匹配(哪些行包含它们)，哪些词不匹配，它们匹配的频率，等等。</p>
<blockquote>
<p>Mysql5.7之后innodb引擎也支持全文索引</p>
</blockquote>
<p>通常在建表的时候添加fulltext索引，例如</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> notes (</span><br><span class="line">	title text,</span><br><span class="line">	fulltext(title)</span><br><span class="line">)engine<span class="operator">=</span>myisam;</span><br></pre></td></tr></table></figure>

<p>也可以使用<code>create index</code> 或者<code>alter table</code>来添加索引</p>
<blockquote>
<p>match() against() 还可以作为一个列，</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select match(title) against(&#x27;rabbit&#x27;) as sc from notes;</span><br></pre></td></tr></table></figure>

<p>sc 表示全文检索的计算出的等级值</p>
<h2 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h2><p>参考：<a target="_blank" rel="noopener" href="https://blog.csdn.net/suo082407128/article/details/82663113">MySQL使用全文索引(fulltext index)_椰汁菠萝-CSDN博客_fulltext index</a></p>
<blockquote>
<p>使用全文索引需要注意的是：(基本单位是词)， MySQL默认的分词是所有非字母和数字的特殊符号都是分词符</p>
</blockquote>
<p>使用Match() 和 Against() 来使用全文索引进行检索</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> note_text <span class="keyword">from</span> notes <span class="keyword">where</span> <span class="keyword">match</span>(note_text) against(<span class="string">&#x27;book&#x27;</span>);</span><br></pre></td></tr></table></figure>

<blockquote>
<p>match() 可以包含多个列，例如match(title,content) , 应该和建立索引时候的顺序一致</p>
<p> 当查询多列数据时，建议在此多列数据上创建一个联合的全文索引，否则使用不了索引的</p>
</blockquote>
<p>检索的文本越靠前，等级值越大。如果包含多个搜索项，则包含多个匹配词的行的等级值更高</p>
<h2 id="查询扩展"><a href="#查询扩展" class="headerlink" title="查询扩展"></a>查询扩展</h2><p>扫描步骤如下：</p>
<ol>
<li>全文检索，筛选结果行</li>
<li>检查匹配行，选择有用词</li>
<li>再次全文检索，包含上个步骤选择词</li>
</ol>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> note_text <span class="keyword">from</span> notes <span class="keyword">where</span> <span class="keyword">match</span>(note_text) against(<span class="string">&#x27;book&#x27;</span> <span class="keyword">with</span> query expansion);</span><br></pre></td></tr></table></figure>

<blockquote>
<p>记录越多，文本越多，使用查询扩展返回的结果越好</p>
</blockquote>
<h2 id="布尔全文检索"><a href="#布尔全文检索" class="headerlink" title="布尔全文检索"></a>布尔全文检索</h2><blockquote>
<p>即使没有fulltext索引也可以使用，但是比较慢且性能差</p>
</blockquote>
<p>关键点：</p>
<ul>
<li>要匹配的词</li>
<li>要排除的词（即使有匹配到的词也会排除掉）</li>
<li>排列提示（指定一些更重要的词，越重要的词等级越高）</li>
<li>表达式分组</li>
<li>其他</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">--匹配heavy 排除rope*（rope开头的词）</span></span><br><span class="line"><span class="keyword">SELECT</span> note_ text <span class="keyword">FROM</span> productnotes <span class="keyword">WHERE</span> <span class="keyword">Match</span>(note_ text) Agai nst( <span class="string">&#x27;heavy -rope*&#x27;</span> <span class="keyword">IN</span> <span class="type">BOOLEAN</span> MODE);</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th>布尔操作符</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>+</td>
<td>包含，词必须存在</td>
</tr>
<tr>
<td>-</td>
<td>排除，词必须不出现</td>
</tr>
<tr>
<td>&gt;</td>
<td>包含且增加等级值</td>
</tr>
<tr>
<td>&lt;</td>
<td>包含且减少等级值</td>
</tr>
<tr>
<td>（）</td>
<td>把词组成子表达式，允许这些组表达式作为一个组被包含，排除，排列等</td>
</tr>
<tr>
<td>~</td>
<td>取消一个词的排序值</td>
</tr>
<tr>
<td>*</td>
<td>词尾的通配符</td>
</tr>
<tr>
<td>“”</td>
<td>定义一个短语，它匹配整个短语</td>
</tr>
</tbody></table>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> note_text <span class="keyword">FROM</span> productnotes <span class="keyword">WHERE</span> <span class="keyword">Match</span>(note_text) Against(<span class="string">&#x27;+rabbit +bait&#x27;</span><span class="keyword">IN</span> <span class="type">BOOLEAN</span> MODE);</span><br><span class="line"><span class="comment">--这个搜索匹配包含词rabbit和bait的行。</span></span><br><span class="line"><span class="keyword">SELECT</span> note_text <span class="keyword">FROM</span> productnotes <span class="keyword">WHERE</span> <span class="keyword">Match</span>(note_text) Against(<span class="string">&#x27;rabbit bait&#x27;</span><span class="keyword">IN</span> <span class="type">BOOLEAN</span> MODE); </span><br><span class="line"><span class="comment">--没有指定操作符，这个搜索匹配包含rabbit和bait中的至少一个词的行。</span></span><br><span class="line"><span class="keyword">SELECT</span> note_text <span class="keyword">FROM</span> productnotes <span class="keyword">WHERE</span> <span class="keyword">Match</span>(note_text) Against(<span class="string">&#x27;&quot;rabbit bait&quot;&#x27;</span><span class="keyword">IN</span> <span class="type">BOOLEAN</span> MODE); </span><br><span class="line"><span class="comment">--这个搜索匹配短语rabbitbait而不是匹配两个词rabbit和bait。</span></span><br><span class="line"><span class="keyword">SELECT</span> note_text <span class="keyword">FROM</span> productnotes <span class="keyword">WHERE</span> <span class="keyword">Match</span>(note_text) Against(<span class="string">&#x27;&gt;rabbit &lt;carrot&#x27;</span><span class="keyword">IN</span> <span class="type">BOOLEAN</span> MODE); </span><br><span class="line"><span class="comment">--匹配rabbit和carrot,增加前者的等级，降低后者的等级。</span></span><br><span class="line"><span class="keyword">SELECT</span> note_text <span class="keyword">FROM</span> productnotes <span class="keyword">WHERE</span> <span class="keyword">Match</span> (note_text) Against(<span class="string">&#x27;+safe +(&lt;Combination)&#x27;</span><span class="keyword">IN</span> <span class="type">BOOLEAN</span> MODE); </span><br><span class="line"><span class="comment">--这个搜索匹配词safe和combination,降低后者的等级。</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>扩展</p>
</blockquote>
<ul>
<li>在索引全文本数据时，短词被忽略且从索引中排除。短词定义为那些具有3个或3个以下字符的词(如果需要,这个数目可以更改)。</li>
<li>MySQL带有一个内建的非用词(stopword) 列表，这些词在索引全文本数据时总是被忽略。如果需要，可以覆盖这个列表(请参阅MySQL文档以了解如何完成此工作)。</li>
<li>许多词出现的频率很高，搜索它们没有用处(返回太多的结果)。因此，MySQL规定了一条50%规则，如果-一个词出现在50%以上的行中，则将它作为一个非用词忽略。50%规则不用于IN BOOLEAN MODE。</li>
<li>如果表中的行数少于3行，则全文本搜索不返回结果(因为每个词或者不出现，或者至少出现在50%的行中)。</li>
<li>忽略词中的单引号。例如，don’t索 引为dont。</li>
<li>不具有词分隔符(包括日语和汉语)的语言不能恰当地返回全文本搜索结果。</li>
</ul>
<p><strong>邻近操作符</strong></p>
<h1 id="视图"><a href="#视图" class="headerlink" title="视图"></a>视图</h1><h2 id="使用视图的优势："><a href="#使用视图的优势：" class="headerlink" title="使用视图的优势："></a>使用视图的优势：</h2><ol start="2">
<li>重用SQL语句</li>
<li>简化复杂的SQL</li>
<li>使用表的组成部分而不是整个表，因此可以作保保护数据即授予表特定部分的访问权限，而不是整个表</li>
<li>更改数据格式，视图可以返回与底层表示和格式不同的数据</li>
</ol>
<p>视图本身不包含数据，使用视图实际上是使用视图的查询规则检索数据。如果修改源表的数据，视图中查询到的数据也会被修改。</p>
<blockquote>
<p>可以通过视图修改数据</p>
</blockquote>
<h2 id="视图创建的规则和限制"><a href="#视图创建的规则和限制" class="headerlink" title="视图创建的规则和限制"></a>视图创建的规则和限制</h2><ol>
<li>视图名不可与其他视图或表名重复</li>
<li>创建视图数量没有限制</li>
<li>创建视图必须有相应访问权限</li>
<li>视图可以嵌套（使用视图再创建视图）</li>
<li>ORDER BY可以在视图中使用，但是如果检索的SQL中有ORDER BY则视图中的被覆盖</li>
<li>视图不能索引，也不能有关联的触发器或者默认值</li>
<li>视图可以和表一起使用</li>
</ol>
<h2 id="使用视图"><a href="#使用视图" class="headerlink" title="使用视图"></a>使用视图</h2><h3 id="创建视图"><a href="#创建视图" class="headerlink" title="创建视图"></a>创建视图</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">view</span> <span class="operator">&lt;</span>view_name<span class="operator">&gt;</span> <span class="keyword">as</span> <span class="operator">&lt;</span>dql<span class="operator">&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="查看创建视图语句"><a href="#查看创建视图语句" class="headerlink" title="查看创建视图语句"></a>查看创建视图语句</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">show</span> <span class="keyword">create</span> <span class="keyword">view</span> <span class="operator">&lt;</span>view_name<span class="operator">&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="删除视图"><a href="#删除视图" class="headerlink" title="删除视图"></a>删除视图</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">drop</span> <span class="keyword">view</span> <span class="operator">&lt;</span>view_name<span class="operator">&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="修改视图"><a href="#修改视图" class="headerlink" title="修改视图"></a>修改视图</h3><p>可以先删除视图在创建，也可以</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">or</span> repace <span class="keyword">view</span> <span class="operator">&lt;</span>view_name<span class="operator">&gt;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>视图可以更新，但是如果Mysql认为基数据不能被正确更新，则不会更新，在以下情况下不会更新</p>
</blockquote>
<ul>
<li>分组 group by 和having</li>
<li>联结</li>
<li>子查询</li>
<li>并</li>
<li>聚集函数</li>
<li>Distinct</li>
<li>导出（计算）列</li>
</ul>
<blockquote>
<p>上面的情况可能随着版本不同而有差异，一般情况下视图用来检索</p>
</blockquote>
<h1 id="存储过程"><a href="#存储过程" class="headerlink" title="存储过程"></a>存储过程</h1><h2 id="使用存储过程"><a href="#使用存储过程" class="headerlink" title="使用存储过程"></a>使用存储过程</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">call</span> procedure_name(<span class="variable">@in</span>, <span class="variable">@out</span>)</span><br></pre></td></tr></table></figure>

<h2 id="创建存储过程"><a href="#创建存储过程" class="headerlink" title="创建存储过程"></a>创建存储过程</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">create procedure procedure_name() comment &#x27;procedure comment&#x27;</span><br><span class="line">begin</span><br><span class="line">select * from notes;</span><br><span class="line">end;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>注意要先使用\d $ 或者delimiter $将分隔符;临时更改为$或者其他字符</p>
</blockquote>
<p>其中<code>()</code>中可接受参数，begin, end 包含的为存储过程体</p>
<p>可以使用参数</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">create procedure get_username(in id int, out name varchar(10))</span><br><span class="line">begin</span><br><span class="line">select `username` into name from users where `id` = id;</span><br><span class="line">end;</span><br><span class="line">--没有测试，正确性未知</span><br></pre></td></tr></table></figure>

<blockquote>
<p>所有变量都必须以@开始</p>
</blockquote>
<p>调用</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">call get_username(1, @ret);</span><br></pre></td></tr></table></figure>

<p>查询执行返回值</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select @ret;</span><br></pre></td></tr></table></figure>

<h3 id="定义变量"><a href="#定义变量" class="headerlink" title="定义变量"></a>定义变量</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">declare</span> total <span class="type">decimal</span>(<span class="number">8</span>,<span class="number">2</span>) <span class="keyword">default</span> <span class="number">0</span>;</span><br></pre></td></tr></table></figure>

<h3 id="判断"><a href="#判断" class="headerlink" title="判断"></a>判断</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">if <span class="operator">&lt;</span>variable<span class="operator">&gt;</span> <span class="keyword">then</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> users;</span><br><span class="line"><span class="keyword">end</span> if;</span><br></pre></td></tr></table></figure>

<p>查看存储过程</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">show</span> <span class="keyword">procedure</span> status [<span class="keyword">like</span> <span class="string">&#x27;keywords&#x27;</span>];</span><br><span class="line"><span class="keyword">show</span> <span class="keyword">create</span> <span class="keyword">procedure</span> <span class="operator">&lt;</span>procudure_name<span class="operator">&gt;</span>;</span><br></pre></td></tr></table></figure>

<h1 id="游标"><a href="#游标" class="headerlink" title="游标"></a>游标</h1><blockquote>
<p>MySQL游标不同于其他多数DBMS， 只能用于存储过程和函数 【早期资料】</p>
</blockquote>
<h2 id="使用游标"><a href="#使用游标" class="headerlink" title="使用游标"></a>使用游标</h2><ul>
<li>使用游标前应该先声明（定义），这个过程实际没有检索数据，只是定义要使用的SELECT 语句</li>
<li>一旦声明后，应该打开游标来使用，这个过程用前面定义的SELECT 语句把数据检索出来</li>
<li>对于填有数据的游标，根据需要取出（检索）各行</li>
<li>结束后必须关闭游标</li>
</ul>
<p>声明游标后，可以频繁地打开或者关闭游标，游标打开后，可以频繁地执行取操作</p>
<h3 id="创建游标"><a href="#创建游标" class="headerlink" title="创建游标"></a>创建游标</h3><p><strong>使用declare 定义游标</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">declare products_f cursor for select * from products order by id;</span><br></pre></td></tr></table></figure>

<p><strong>定义游标之后可以打开游标</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">open products_f;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>open 语句执行查询，存储检索到地数据以提供浏览和滚动。</p>
</blockquote>
<p><strong>游标处理完成，应该关闭游标</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">close products_f;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>关闭游标会释放游标所使用地内存等资源，所以当游标不再需要使用地时候就应该关闭游标，如果你不明确关闭游标，MySQL会在end语句时关闭游标。</p>
</blockquote>
<p><strong>使用游标数据</strong></p>
<p>游标被打开后，可以使用fetch语句访问它的每一行。fetch指定检索所需的列，数据存放位置，还会向前移动游标内部指针，使下一条fetch语句检索下一行。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fetch products_f into o;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>检索游标中结果的第一行并将数据存放到局部变量o中，再次执行fetch将检索下一行，除了使用repeat ,还可以使用其他循环语句来重复执行，直到使用leave手动退出，通常repeat的语法更适合对游标进行循环。</p>
</blockquote>
<p><strong>例子</strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">procedure</span> products_p()</span><br><span class="line"><span class="keyword">begin</span></span><br><span class="line">	<span class="keyword">declare</span> done <span class="type">boolean</span> <span class="keyword">default</span> <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">declare</span> o <span class="type">int</span>;</span><br><span class="line">	<span class="keyword">declare</span> products_f <span class="keyword">cursor</span> </span><br><span class="line">	<span class="keyword">for</span> </span><br><span class="line">	<span class="keyword">select</span> id <span class="keyword">from</span> users;</span><br><span class="line">	<span class="comment">-- continue handler 条件出现时被执行的代码 即 SQLSTATE &#x27;02000&#x27;出现时执行set done = 1</span></span><br><span class="line">	<span class="comment">-- SQLSTATE &#x27;02000&#x27;是一个未找到条件，即没有更多行时候不再循环 ，更多错误代码列可以查看MySQL手册https://dev.mysql.com/doc/refman/8.0/en/error-handling.html</span></span><br><span class="line">	<span class="keyword">declare</span> continue handler <span class="keyword">for</span> <span class="keyword">SQLSTATE</span> <span class="string">&#x27;02000&#x27;</span> <span class="keyword">set</span> done <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line">	<span class="keyword">open</span> products_f;</span><br><span class="line">	<span class="comment">-- 反复执行知道done为真</span></span><br><span class="line">	repeat</span><br><span class="line">		<span class="keyword">fetch</span> products_f <span class="keyword">into</span> o;</span><br><span class="line">	until done <span class="keyword">end</span> repeat;</span><br><span class="line">	<span class="keyword">close</span> products_f;</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p> DECLARE语句的次序： DECLARE语句的发布存在特定的次序。用DECLARE语句定义的局部变量必须在定义任意游标或句柄之前定义，而句柄必须在游标之后定义，不遵守此顺序将产生错误消息。</p>
</blockquote>
<h1 id="触发器"><a href="#触发器" class="headerlink" title="触发器"></a>触发器</h1><p>MySQL响应delete, insert, update语句而执行触发的一条SQL或位于begin, end 之间的一组SQL。其他MySQL语句不支持触发器。</p>
<h2 id="创建触发器"><a href="#创建触发器" class="headerlink" title="创建触发器"></a>创建触发器</h2><p>创建触发器需要提供以下信息</p>
<ul>
<li>唯一的触发器名</li>
<li>触发器关联的表</li>
<li>触发器应该响应的活动（delete, insert, update）</li>
<li>触发器何时执行（前或者后）</li>
</ul>
<blockquote>
<p>触发器名必须在每个表中唯一，而在每个数据库中不一定唯一。这在其它DBMS中是不允许的。最好是在同一个数据库中保持触发器名唯一</p>
</blockquote>
<p>使用<code>create trigger</code> 创建触发器</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">trigger</span> get_id after <span class="keyword">insert</span> <span class="keyword">on</span> users <span class="keyword">for</span> <span class="keyword">each</span> <span class="type">row</span> <span class="keyword">select</span> <span class="string">&#x27;insert&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p>其中for each row 表示代码对每个插入执行</p>
<blockquote>
<p>只有表支持触发器，视图不支持，每个表每个事件只允许一个触发器，因此每个表支支持6个触发器（insert, update, delete 前后 ）。 如果before触发器执行失败，则MySQL不执行请求的操作，如果触发器或语句本身失败，如果有after触发器，则不执行。</p>
</blockquote>
<h2 id="删除触发器"><a href="#删除触发器" class="headerlink" title="删除触发器"></a>删除触发器</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">drop</span> <span class="keyword">trigger</span> get_id;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>触发器不能更新或者覆盖，因此必须先删除再创建</p>
</blockquote>
<h2 id="使用-1"><a href="#使用-1" class="headerlink" title="使用"></a>使用</h2><p><strong>insert 触发器</strong></p>
<ul>
<li>在insert 触发器代码内，可引用一个NEW的虚拟表，访问被插入的行</li>
<li>在before insert 触发器内，NEW中的值也可以被更新（允许更改被插入的值）</li>
<li>对于auto_increment 列，NEW 在insert 之前包含0，在insert 执行之后包含新的自动生成的值</li>
</ul>
<p><strong>delete 触发器</strong></p>
<p>在delete 触发器代码内，你可以引用一个名为OLD的虚拟表，访问被删除的行。</p>
<p>OLD中的值全部是只读的，不能更新</p>
<p>下面例子，使用OLD保存将要被删除的行到一个存档表中：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">create trigger 触发器名 before delete on 表1 for each row </span><br><span class="line">begin </span><br><span class="line">	insert into 表2(列,列,列)values(old.表1列名,old.表1列名,old.表1列名);</span><br><span class="line">end</span><br></pre></td></tr></table></figure>

<p>删除表1的数据前会把数据存到结构相同的表2中<br>使用begin end 块的好处是触发器能容纳多条sql语句</p>
<p>**UPDATE 触发器 **</p>
<p>在update触发器代码中，可以引用一个名为old虚拟表访问以前的值，引用new虚拟表访问新更新的值</p>
<p>new中的值可能被更新，old中的值全部是只读的</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">create trigger 触发器名 before update on 表1 for each row set new.id = upper(new.id);</span><br></pre></td></tr></table></figure>


<p>显然，每次更新一个行时，new.id 中的值（将用来更新表行的值）都用upper(new.id)替换。 也就是，如果new.id &#x3D; 110，那用update更新表1的id时，将用110这个值更新。</p>
<p><strong>触发器的进一步介绍</strong></p>
<p>触发器可以用来创建审计跟踪，使用触发器，把更改记录到另一个表非常容易</p>
<p>mysql触发器不支持call语句，这表示不能从触发器内调用存储过程，只能把存储过程代码复制到触发器内</p>
<h1 id="事务"><a href="#事务" class="headerlink" title="事务"></a>事务</h1><h2 id="术语"><a href="#术语" class="headerlink" title="术语"></a>术语</h2><p><strong>事务（transaction）</strong>指一组SQL语句</p>
<p><strong>回滚（rollback）</strong>撤销指定SQL执行过程</p>
<p><strong>提交（commit）</strong>将为存储的SQL语句结果写入数据表</p>
<p><strong>保留点（savepoint）</strong>事务处理中设置的临时占位符（place holder） ,可以发布或者回退（与回退整个事务不同）</p>
<blockquote>
<p>事务用来管理insert, update, delete 语句，不能回退drop，select， create 操作，即使使用了也不会撤销。</p>
</blockquote>
<p>隐含事务提交：commit 或者rollback 后事务会自动关闭。</p>
<h2 id="保留点"><a href="#保留点" class="headerlink" title="保留点"></a>保留点</h2><p>简单的commit或者rollback会撤销整个事务，但是实际上可能需要回滚或者提交一部分事务，就需要在事务处理块中放置合适的保留点，回滚时回滚到某个保留点，可以使用savepoint创建保留点。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">savepoint delete1;</span><br></pre></td></tr></table></figure>

<p>当需要回滚时，可以指定保留点</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rollback to delete1</span><br></pre></td></tr></table></figure>

<blockquote>
<p>可以尽可能多地创建保留点，因为这样就可以更灵活地控制事务。当执行commit 或者rollback 后自动释放保留点，也可以使用release savepoint 释放保留点。</p>
</blockquote>
<h2 id="更改默认提交行为"><a href="#更改默认提交行为" class="headerlink" title="更改默认提交行为"></a>更改默认提交行为</h2><p>关闭自动提交</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">set autocommit = 0</span><br></pre></td></tr></table></figure>

<blockquote>
<p>该标志是针对当前连接而不是服务器</p>
</blockquote>
<h1 id="字符集和编码"><a href="#字符集和编码" class="headerlink" title="字符集和编码"></a>字符集和编码</h1><p><strong>字符集</strong> 字母和符号的集合</p>
<p><strong>编码</strong> 某个字符集内成员的内部表示</p>
<p><strong>校对</strong> 规定字符集如何比较的指令</p>
<p>查看可用的校对和字符集</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">show collation;</span><br><span class="line">show variables like &#x27;%character%&#x27;;</span><br><span class="line">show variables like &#x27;%collation%&#x27;;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>可以给单个表，单个列设置字符集和校对</p>
</blockquote>
<p>select 语句中可以指定使用不同的校对，例如可以使用区分大小写的校对</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from users order by username collate latin1_general_cs;</span><br></pre></td></tr></table></figure>

<p>使用cast() 或者convert() 可以在字符集之间转换</p>
<h1 id="数据备份"><a href="#数据备份" class="headerlink" title="数据备份"></a>数据备份</h1><h2 id="数据备份-1"><a href="#数据备份-1" class="headerlink" title="数据备份"></a>数据备份</h2><p>mysqldump</p>
<p>mysqlhotcopy 从一个数据库复制全部数据</p>
<p>back up table &#x2F; select into outfile    -&gt;  restore table </p>
<blockquote>
<p>为保证所有数据都被写到磁盘（包括索引数据），可能需要在备份前使用flush tables 语句</p>
</blockquote>
<p>命令行下具体用法如下： </p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysqldump -u用戶名 -p密码 -d 数据库名 表名 &gt; 脚本名;</span><br></pre></td></tr></table></figure>

<p>导出整个数据库结构和数据</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysqldump -h localhost -uroot -p123456 database &gt; dump.sql</span><br></pre></td></tr></table></figure>

<p>导出整个数据库结构和数据[包含建库语句]</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysqldump -h localhost -uroot -p123456 -B database &gt; dump.sql</span><br></pre></td></tr></table></figure>

<p>导出单个数据表结构和数据</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysqldump -h localhost -uroot -p123456  database table &gt; dump.sql</span><br></pre></td></tr></table></figure>

<p>导出整个数据库结构（不包含数据）</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysqldump -h localhost -uroot -p123456  -d database &gt; dump.sql</span><br></pre></td></tr></table></figure>

<p>导出单个数据表结构（不包含数据）</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysqldump -h localhost -uroot -p123456  -d database table &gt; dump.sql</span><br></pre></td></tr></table></figure>

<h2 id="恢复"><a href="#恢复" class="headerlink" title="恢复"></a>恢复</h2><p>未登录</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql <span class="operator">-</span>uroot <span class="operator">-</span>proot <span class="operator">-</span>h127<span class="number">.0</span><span class="number">.0</span><span class="number">.1</span> <span class="operator">-</span>P3306 test<span class="operator">&lt;</span>s1.sql</span><br></pre></td></tr></table></figure>

<p>登录</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">source .<span class="operator">/</span>a.sql</span><br></pre></td></tr></table></figure>

<h2 id="数据维护"><a href="#数据维护" class="headerlink" title="数据维护"></a>数据维护</h2><ul>
<li>analyze table 检查表键是否正确</li>
<li>check table 针对许多问题进行检查，在myisam引擎上还针对索引进行检查 , 如果在Myisam引擎上产生的结果不正确，可能需要使用repare table 修复响应的表。</li>
<li>changed 检查自最后一次检查以来改动过的表</li>
<li>extended 执行最彻底的检查</li>
<li>fast 检查未正常关闭的表</li>
<li>medium 检查所有被删除的链接并进行键检验</li>
<li>quick 只进行快速扫描</li>
<li>optimize table  优化表，如果有大量删除操作，应该使用</li>
</ul>
<h2 id="诊断启动问题"><a href="#诊断启动问题" class="headerlink" title="诊断启动问题"></a>诊断启动问题</h2><ul>
<li>–safe-mode 装载减去某些最佳配置的服务器</li>
<li>–verbose 显示全文本消息，常与–help 联合使用</li>
</ul>
<h2 id="查看日志文件"><a href="#查看日志文件" class="headerlink" title="查看日志文件"></a>查看日志文件</h2><ul>
<li>错误日志，包含启停或任意关键位置的错误细节，日志名通常为hostname.err 位于data 目录， 可用–log-error 命令更改</li>
<li>查询日志，记录MySQL活动，在诊断问题时非常有用，日志可能会很快变得很大，所以不应该长期使用，位于data 目录，可用–log更改</li>
<li>二进制日志(bin-log)，记录更新或者可能更新过数据的所有语句，日志名通常为hostname-bin，位于data 目录，可用–log-bin 更改</li>
<li>慢查询日志， 可用–log-slow-queries 更改</li>
</ul>
<h1 id="性能优化"><a href="#性能优化" class="headerlink" title="性能优化"></a>性能优化</h1><p>MySQL 使用一系列默认配置预先配置的，但随着需求增加，往往需要重新调整分配内存，缓冲区等等。可以使用下面的命令查看变量以及状态</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">show [global] variables;</span><br><span class="line">show status;</span><br></pre></td></tr></table></figure>

<p>当你遇到MySQL性能显著不良的时候，可以使用</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">show [full] processlist</span><br></pre></td></tr></table></figure>

<p>查看活动以及他们的线程id和执行时间，可以使用kill 来终止</p>
<p>使用explain [analyze] 来解释如何执行一条SQL</p>
<p>一般来说，存储过程比一条一条执行SQL性能好</p>
<p>insert  支持一个可选的 delayed 关键字，如果使用，将把控制立即返回给调用程序，并且一旦有可能就实际执行该操作</p>
<p>在导入数据时，应该关闭自动提交，临时禁用索引，索引在导入完成后再开启</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">alter table notes disable/enable keys;</span><br></pre></td></tr></table></figure>

<p>如果SQL存在大量OR，可以尝试使用union关键字连接结果</p>
<p>索引可能会加快查询，也可能会降低插入，更新速度</p>
<p>一般来说，尽量使用fulltext 而不是用like</p>
<h1 id="其他语法"><a href="#其他语法" class="headerlink" title="其他语法"></a>其他语法</h1><h2 id="alter"><a href="#alter" class="headerlink" title="alter"></a>alter</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">alter table &lt;table_name&gt;</span><br><span class="line">(</span><br><span class="line">	add column &lt;column_name&gt;    datatype [null|not null] [constraint],</span><br><span class="line">	change column &lt;column_name&gt; datatype [null|not null] [constraint], </span><br><span class="line">	drop column &lt;column_name&gt;</span><br><span class="line">	add index &lt;column_name&gt; </span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">ALTER table Teacher change Tid Tnum int; //修改列名</span><br></pre></td></tr></table></figure>

<h2 id="create-index"><a href="#create-index" class="headerlink" title="create index"></a>create index</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">create index &lt;index_name&gt; on &lt;table_name&gt; (column [desc|asc], ...);</span><br></pre></td></tr></table></figure>

<h2 id="create-user"><a href="#create-user" class="headerlink" title="create user"></a>create user</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">create user &lt;username&gt;[@host] identified [with mysql_native_password] by &lt;password&gt;; </span><br></pre></td></tr></table></figure>

<h2 id="drop"><a href="#drop" class="headerlink" title="drop"></a>drop</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">drop database|index|procedure|table|trigger|user|view|itemname;</span><br></pre></td></tr></table></figure>

<h2 id="insert-select"><a href="#insert-select" class="headerlink" title="insert select"></a>insert select</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">insert into users select * from users_bak;</span><br></pre></td></tr></table></figure>

<h2 id="select-1"><a href="#select-1" class="headerlink" title="select"></a>select</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> </span><br><span class="line">	<span class="keyword">column</span> </span><br><span class="line"><span class="keyword">from</span> </span><br><span class="line">	table_name</span><br><span class="line"><span class="keyword">where</span></span><br><span class="line"><span class="keyword">union</span></span><br><span class="line"><span class="keyword">group</span> <span class="keyword">by</span> </span><br><span class="line"><span class="keyword">having</span></span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span></span><br></pre></td></tr></table></figure>

<h2 id="事务-1"><a href="#事务-1" class="headerlink" title="事务"></a>事务</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">start transaction;</span><br></pre></td></tr></table></figure>

<h2 id="排序-1"><a href="#排序-1" class="headerlink" title="排序"></a>排序</h2><p>字符串以字典顺序排序，从左向右一次比较每一个字符，这将导致‘10‘位于’2‘之前，数值才能正确排序。</p>
<h1 id="删除"><a href="#删除" class="headerlink" title="删除"></a>删除</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">drop procedure &lt;procedure_name&gt; [if exists]</span><br></pre></td></tr></table></figure>


<h1 id="插入"><a href="#插入" class="headerlink" title="插入"></a>插入</h1><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">insert</span> 语句耗时，可能因为等待而降低<span class="keyword">select</span>性能，所以使用下面的语句降低有限级</span><br><span class="line"><span class="keyword">INSERT</span> LOW_PRIORITY <span class="keyword">INTO</span></span><br><span class="line"><span class="comment">--降低insert的有限级，同样适用于update,delete。</span></span><br></pre></td></tr></table></figure>

<h2 id="更新"><a href="#更新" class="headerlink" title="更新"></a>更新</h2><p>更新可以使用子查询，即将查到的值更新到列。<br>update ignore 可以忽略错误</p>
<p>更新表不能包含该表的子查询例如</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">update user set sex = 1 where id in (select id from user where age &gt; 8)</span><br></pre></td></tr></table></figure>

<p>上面的SQL会报错，应该更改为</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">update user left inner join (select id from user where age &gt; 8) set sex = 1;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>上面的SQL只是示例</p>
</blockquote>
<h2 id="删除-1"><a href="#删除-1" class="headerlink" title="删除"></a>删除</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">truncate [table] users;</span><br><span class="line">delete from </span><br></pre></td></tr></table></figure>


<h1 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h1><p>外键不能跨引擎，例如myisam不能添加innodb表的主键为外键</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">rename <span class="keyword">table</span> notes <span class="keyword">to</span> note;</span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> notes rename <span class="keyword">to</span> note;</span><br></pre></td></tr></table></figure>

<h1 id="Mysql添加自增列"><a href="#Mysql添加自增列" class="headerlink" title="Mysql添加自增列"></a>Mysql添加自增列</h1><p>两句查完：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">set</span> <span class="variable">@rownum</span><span class="operator">=</span><span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> (<span class="variable">@rownum</span>:<span class="operator">=</span><span class="variable">@rownum</span><span class="operator">+</span><span class="number">1</span>),colname <span class="keyword">from</span> [tablename <span class="keyword">or</span> (subquery) a];</span><br></pre></td></tr></table></figure>

<p>一句查完：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select @rownum:=@rownum+1,colnum from (select @rownum:=0) a,[tablename or (subquery) b];</span><br></pre></td></tr></table></figure>


<blockquote>
<p>多条SQL要用<code>;</code>分割，单条SQL末尾的分号非必须，推荐加上分号，如果使用命令行，则必须要有结尾符。</p>
</blockquote>
<blockquote>
<p>SQL 语句不区分大小写。最佳的方式是按照大小写惯例，且使用时保持一致。</p>
</blockquote>
<blockquote>
<p>SQL可以分成多行，用更直观的格式表达</p>
</blockquote>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">desc</span> <span class="operator">/</span> <span class="keyword">describe</span> <span class="operator">&lt;</span><span class="keyword">table</span><span class="operator">&gt;</span>;</span><br></pre></td></tr></table></figure>

<h1 id="函数-1"><a href="#函数-1" class="headerlink" title="函数"></a>函数</h1><h2 id="COALLESCE"><a href="#COALLESCE" class="headerlink" title="COALLESCE"></a>COALLESCE</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">COALESCE(expression, value1, value2, valuen)</span><br></pre></td></tr></table></figure>

<p>返回按顺序取第一个不为NULL的值，都为NULL则返回NULL, 因为不判断空字符串，所以如果有空字符串则需要先处理，例如：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">COALESCE(NULLIF(text1, &#x27;&#x27;), NULLIF(text2, &#x27;&#x27;))</span><br></pre></td></tr></table></figure>
<p>其他替代</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">--MYSQL: </span><br><span class="line">  IFNULL(expression,value) </span><br><span class="line">--MSSQLServer: </span><br><span class="line">  ISNULL(expression,value) </span><br><span class="line">--Oracle: </span><br><span class="line">  NVL(expression,value)</span><br></pre></td></tr></table></figure>

<h2 id="格式化时间日期"><a href="#格式化时间日期" class="headerlink" title="格式化时间日期"></a>格式化时间日期</h2><p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/shuilangyizu/p/8036620.html">https://www.cnblogs.com/shuilangyizu/p/8036620.html</a></p>
<h2 id="IF"><a href="#IF" class="headerlink" title="IF"></a>IF</h2><p>Mysql的if既可以作为表达式用，也可在存储过程中作为流程控制语句使用<br>IF表达式</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">IF(expr1,expr2,expr3)</span><br></pre></td></tr></table></figure>



<p>如果 expr1 是TRUE (expr1 &lt;&gt; 0 and expr1 &lt;&gt; NULL)，则 IF()的返回值为expr2; 否则返回值则为 expr3。IF() 的返回值为数字值或字符串值，具体情况视其所在语境而定。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select *,if(sva=1,&quot;男&quot;,&quot;女&quot;) as ssva from taname where sva != &quot;&quot;</span><br></pre></td></tr></table></figure>



<p>作为表达式的if也可以用CASE when来实现：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select CASE sva WHEN 1 THEN &#x27;男&#x27; ELSE &#x27;女&#x27; END as ssva from taname where sva != &#x27;&#x27;</span><br></pre></td></tr></table></figure>



<p>在第一个方案的返回结果中， value&#x3D;compare-value。而第二个方案的返回结果是第一种情况的真实结果。如果没有匹配的结果值，则返回结果为ELSE后的结果，如果没有ELSE 部分，则返回值为 NULL。</p>
<p>例如：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">SELECT CASE 1 WHEN 1 THEN &#x27;one&#x27;</span><br><span class="line">              WHEN 2 THEN &#x27;two&#x27;</span><br><span class="line">              ELSE &#x27;more&#x27; END</span><br><span class="line">              as testCol</span><br></pre></td></tr></table></figure>

<p>将输出one</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">IFNULL(expr1,expr2)</span><br></pre></td></tr></table></figure>


<p>假如expr1 不为 NULL，则 IFNULL() 的返回值为 expr1; 否则其返回值为 expr2。IFNULL()的返回值是数字或是字符串，具体情况取决于其所使用的语境。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; SELECT IFNULL(1,0);</span><br><span class="line">        -&gt; 1</span><br><span class="line"></span><br><span class="line">mysql&gt; SELECT IFNULL(NULL,10);</span><br><span class="line">        -&gt; 10</span><br><span class="line"></span><br><span class="line">mysql&gt; SELECT IFNULL(1/0,10);</span><br><span class="line">        -&gt; 10</span><br><span class="line"></span><br><span class="line">mysql&gt; SELECT IFNULL(1/0,&#x27;yes&#x27;);</span><br><span class="line">        -&gt; &#x27;yes&#x27;</span><br></pre></td></tr></table></figure>


<p>IFNULL(expr1,expr2) 的默认结果值为两个表达式中更加“通用”的一个，顺序为STRING、 REAL或 INTEGER。</p>
<p>IF ELSE 做为流程控制语句使用<br>if实现条件判断，满足不同条件执行不同的操作，这个我们只要学编程的都知道if的作用了，下面我们来看看mysql 存储过程中的if是如何使用的吧。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">IF search_condition <span class="keyword">THEN</span></span><br><span class="line">    statement_list</span><br><span class="line">[ELSEIF search_condition <span class="keyword">THEN</span>]</span><br><span class="line">    statement_list ...</span><br><span class="line">[<span class="keyword">ELSE</span></span><br><span class="line">    statement_list]</span><br><span class="line"><span class="keyword">END</span> IF</span><br></pre></td></tr></table></figure>

<p>当IF中条件search_condition成立时，执行THEN后的statement_list语句，否则判断ELSEIF中的条件，成立则执行其后的statement_list语句，否则继续判断其他分支。当所有分支的条件均不成立时，执行ELSE分支。search_condition是一个条件表达式，可以由“&#x3D;、&lt;、&lt;&#x3D;、&gt;、&gt;&#x3D;、!&#x3D;”等条件运算符组成，并且可以使用AND、OR、NOT对多个表达式进行组合。</p>
<p>例如，建立一个存储过程，该存储过程通过学生学号（student_no）和课程编号（course_no）查询其成绩（grade），返回成绩和成绩的等级，成绩大于90分的为A级，小于90分大于等于80分的为B级，小于80分大于等于70分的为C级，依次到E级。那么，创建存储过程的代码如下：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">procedure</span> dbname.proc_getGrade</span><br><span class="line">(stu_no <span class="type">varchar</span>(<span class="number">20</span>),cour_no <span class="type">varchar</span>(<span class="number">10</span>))</span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line"><span class="keyword">declare</span> stu_grade <span class="type">float</span>;</span><br><span class="line"><span class="keyword">select</span> grade <span class="keyword">into</span> stu_grade <span class="keyword">from</span> grade <span class="keyword">where</span> student_no<span class="operator">=</span>stu_no <span class="keyword">and</span> course_no<span class="operator">=</span>cour_no;</span><br><span class="line">if stu_grade<span class="operator">&gt;=</span><span class="number">90</span> <span class="keyword">then</span></span><br><span class="line">    <span class="keyword">select</span> stu_grade,<span class="string">&#x27;A&#x27;</span>;</span><br><span class="line">elseif stu_grade<span class="operator">&lt;</span><span class="number">90</span> <span class="keyword">and</span> stu_grade<span class="operator">&gt;=</span><span class="number">80</span> <span class="keyword">then</span></span><br><span class="line">    <span class="keyword">select</span> stu_grade,<span class="string">&#x27;B&#x27;</span>;</span><br><span class="line">elseif stu_grade<span class="operator">&lt;</span><span class="number">80</span> <span class="keyword">and</span> stu_grade<span class="operator">&gt;=</span><span class="number">70</span> <span class="keyword">then</span></span><br><span class="line">    <span class="keyword">select</span> stu_grade,<span class="string">&#x27;C&#x27;</span>;</span><br><span class="line">elseif stu_grade70 <span class="keyword">and</span> stu_grade<span class="operator">&gt;=</span><span class="number">60</span> <span class="keyword">then</span></span><br><span class="line">    <span class="keyword">select</span> stu_grade,<span class="string">&#x27;D&#x27;</span>;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">    <span class="keyword">select</span> stu_grade,<span class="string">&#x27;E&#x27;</span>;</span><br><span class="line"><span class="keyword">end</span> if;</span><br><span class="line"><span class="keyword">END</span></span><br></pre></td></tr></table></figure>


<p>注意：IF作为一条语句，在END IF后需要加上分号“;”以表示语句结束，其他语句如CASE、LOOP等也是相同的。</p>
<blockquote>
<p>help show 查看允许的show语句</p>
</blockquote>
<h1 id="其他-1"><a href="#其他-1" class="headerlink" title="其他"></a>其他</h1><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tee /home/cheng/log.sql</span><br></pre></td></tr></table></figure>

<p>将下面的操作都写入改日志</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">grant</span> <span class="keyword">all</span> privileges <span class="keyword">on</span> testdb.<span class="operator">*</span> <span class="keyword">to</span> ‘test_user’@’localhost’ identified <span class="keyword">by</span> “jack” <span class="keyword">with</span> <span class="keyword">grant</span> option;</span><br></pre></td></tr></table></figure>

<p>WITH GRANT OPTION 这个选项表示该用户可以将自己拥有的权限授权给别人。注意：经常有人在创建操作用户的时候不指定WITH GRANT OPTION选项导致后来该用户不能使用GRANT命令创建用户或者给其它用户授权。<br>如果不想这个用户有这个grant的权限，可以不加这句</p>
<h2 id="mysql的SQL长度限制"><a href="#mysql的SQL长度限制" class="headerlink" title="mysql的SQL长度限制"></a>mysql的SQL长度限制</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">max_allowed_packet = 6M</span><br></pre></td></tr></table></figure>

<p>把上面这个配置改大就行了</p>
<h2 id="监听SQL"><a href="#监听SQL" class="headerlink" title="监听SQL"></a>监听SQL</h2><p>登录mysql</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">set global general_log_file=&#x27;/tmp/general.log&#x27;;</span><br><span class="line">set global general_log=&#x27;on&#x27;;</span><br></pre></td></tr></table></figure>
<p>之后执行命令都会记录进LOG</p>
<h2 id="排序-2"><a href="#排序-2" class="headerlink" title="排序"></a>排序</h2><p>MySQL中的排序ORDER BY 除了可以用ASC和DESC，还可以自定义字符串&#x2F;数字来实现排序。</p>
<p>格式如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT * FROM table ORDER BY FIELD(status,1,2,0);</span><br></pre></td></tr></table></figure>

<p>这样子写的话，返回的结果集是按照字段status的1、2、0进行排序的，当然，也可以对字符串进行排序。</p>
<p>原理如下：</p>
<p>FIELD()函数是将参数1的字段对后续参数进行比较，并返回1、2、3等等，如果遇到null或者没有在结果集上存在的数据，则返回0，然后根据升序进行排序。</p>
<h1 id="json字段"><a href="#json字段" class="headerlink" title="json字段"></a>json字段</h1><p>自<em>MySQL5.7.8</em>版本以来，MySQL支持原生JSON数据类型。允许使用原生JSON数据类型比以前MySQL版本中所使用JSON文本格式更能有效地存储JSON文档。</p>
<p>MySQL以内部格式存储JSON文档，允许对文档元素的快速读取访问。JSON二进制格式的结构是允许服务器通过键或数组索引直接搜索JSON文档中的值，这非常快。</p>
<p>JSON文档的存储大约与存储<code>LONGBLOB</code>或<code>LONGTEXT</code>数据量相同。</p>
<p>要定义数据类型为JSON的列，请使用以下语法：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `json_test` (</span><br><span class="line">  `id` <span class="type">int</span>(<span class="number">11</span>) unsigned <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `j` json <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  <span class="keyword">PRIMARY</span> KEY (`id`)</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8mb4;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>json列不能有默认值，而且不能直接编入索引，可以在包含从json列中提取的生成列上创建索引，当从JSON列查询数据时，MySQL优化器将在匹配JSON表达式的虚拟列上查找兼容的索引。</p>
</blockquote>
<p>如下json数据，存储为两条记录</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> json_test <span class="keyword">values</span>(<span class="number">2</span>, <span class="string">&#x27;&#123;&quot;name&quot;:&quot;test&quot;,&quot;age&quot;: 14&#125;&#x27;</span>);</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> json_test <span class="keyword">values</span>(<span class="number">2</span>, <span class="string">&#x27;&#123;&quot;name&quot;:&quot;test1&quot;,&quot;age&quot;: 12&#125;&#x27;</span>);</span><br></pre></td></tr></table></figure>

<p>查询，使用列路径运算符(<code>-&gt;</code>)</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> id, j<span class="operator">-</span><span class="operator">&gt;</span><span class="string">&#x27;$.name&#x27;</span> <span class="keyword">as</span> name <span class="keyword">from</span> json_test;</span><br></pre></td></tr></table></figure>

<p>查询结果如下</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">+----+------------+</span><br><span class="line">| id | name       |</span><br><span class="line">+----+------------+</span><br><span class="line">|  1 | &quot;chengyao&quot; |</span><br><span class="line">|  2 | &quot;test&quot;     |</span><br><span class="line">+----+------------+</span><br></pre></td></tr></table></figure>

<p>name列值中有引号，怎么去掉，可以使用内联路径运算符( <code>-&gt;&gt;</code>)</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> id, j<span class="operator">-</span><span class="operator">&gt;&gt;</span><span class="string">&#x27;$.name&#x27;</span> <span class="keyword">as</span> name <span class="keyword">from</span> json_test;</span><br></pre></td></tr></table></figure>

<p>查询结果</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">+----+----------+</span><br><span class="line">| id | name     |</span><br><span class="line">+----+----------+</span><br><span class="line">|  1 | chengyao |</span><br><span class="line">|  2 | test     |</span><br><span class="line">+----+----------+</span><br></pre></td></tr></table></figure>

<p>json函数： <a target="_blank" rel="noopener" href="https://blog.csdn.net/dragonpeng2008/article/details/89479698">(53条消息) MySQL常用Json函数_dragonpeng2008的博客-CSDN博客</a></p>
<h1 id="生成列"><a href="#生成列" class="headerlink" title="生成列"></a>生成列</h1><p><em>MySQL 5.7</em>引入了一个名为<em>生成列</em>的新功能。它之所以叫作<em>生成列</em>，因为此列中的数据是基于预定义的表达式或从其他列计算的。</p>
<p>例如，假设有以下结构的一个<code>contacts</code>表：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> IF <span class="keyword">NOT</span> <span class="keyword">EXISTS</span> contacts (</span><br><span class="line">    id <span class="type">INT</span> AUTO_INCREMENT <span class="keyword">PRIMARY</span> KEY,</span><br><span class="line">    first_name <span class="type">VARCHAR</span>(<span class="number">50</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">    last_name <span class="type">VARCHAR</span>(<span class="number">50</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">    email <span class="type">VARCHAR</span>(<span class="number">100</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span></span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p>要获取联系人的全名，请使用<code>CONCAT()</code>函数，如下所示：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> </span><br><span class="line">    id, CONCAT(first_name, <span class="string">&#x27; &#x27;</span>, last_name), email</span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">    contacts;</span><br></pre></td></tr></table></figure>

<p>这不是最优的查询。</p>
<p>通过使用MySQL生成的列，可以重新创建<code>contacts</code>表，如下所示：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> IF <span class="keyword">EXISTS</span> contacts;</span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> contacts (</span><br><span class="line">    id <span class="type">INT</span> AUTO_INCREMENT <span class="keyword">PRIMARY</span> KEY,</span><br><span class="line">    first_name <span class="type">VARCHAR</span>(<span class="number">50</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">    last_name <span class="type">VARCHAR</span>(<span class="number">50</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">    fullname <span class="type">varchar</span>(<span class="number">101</span>) GENERATED ALWAYS <span class="keyword">AS</span> (CONCAT(first_name,<span class="string">&#x27; &#x27;</span>,last_name)),</span><br><span class="line">    email <span class="type">VARCHAR</span>(<span class="number">100</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span></span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p><code>GENERATED ALWAYS as(expression)</code>是创建生成列的语法。要测试“全名”列，请在<code>contacts</code>表中插入一行。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> contacts(first_name,last_name, email)</span><br><span class="line"><span class="keyword">VALUES</span>(<span class="string">&#x27;john&#x27;</span>,<span class="string">&#x27;doe&#x27;</span>,<span class="string">&#x27;john.doe@yiibai.com&#x27;</span>);</span><br></pre></td></tr></table></figure>

<p>现在，可以从<code>contacts</code>表中查询数据。</p>
<p>当从<code>contacts</code>表中查询数据时，<code>fullname</code>列中的值将立即计算。</p>
<p>MySQL提供了两种类型的生成列：存储和虚拟。每次读取数据时，虚拟列都将在运行中计算，而存储的列在数据更新时被物理计算和存储。</p>
<p>基于此定义，上述示例中的<code>fullname</code>列是虚拟列。</p>
<h2 id="MySQL生成列的语法"><a href="#MySQL生成列的语法" class="headerlink" title="MySQL生成列的语法"></a>MySQL生成列的语法</h2><p>定义生成列的语法如下：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">column_name data_type [GENERATED ALWAYS] <span class="keyword">AS</span> (expression)</span><br><span class="line">   [VIRTUAL <span class="operator">|</span> STORED] [<span class="keyword">UNIQUE</span> [KEY]]</span><br></pre></td></tr></table></figure>

<p>首先，指定列名及其数据类型。</p>
<p>接下来，添加<code>GENERATED ALWAYS</code>子句以指示列是生成的列。</p>
<p>然后，通过使用相应的选项来指示生成列的类型：<code>VIRTUAL</code>或<code>STORED</code>。 默认情况下，如果未明确指定生成列的类型，MySQL将使用<code>VIRTUAL</code>。</p>
<p>之后，在<code>AS</code>关键字后面的大括号内指定表达式。 该表达式可以包含文字，内置函数，无参数，操作符或对同一表中任何列的引用。 如果你使用一个函数，它必须是标量和确定性的。</p>
<p>最后，如果生成的列被存储，可以为它定义一个唯一约束。</p>
<h2 id="MySQL存储列示例"><a href="#MySQL存储列示例" class="headerlink" title="MySQL存储列示例"></a>MySQL存储列示例</h2><p>我们来看一下<code>products</code>表。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">mysql<span class="operator">&gt;</span> <span class="keyword">desc</span> products;</span><br><span class="line"><span class="operator">+</span><span class="comment">--------------------+---------------+------+-----+---------+-------+</span></span><br><span class="line"><span class="operator">|</span> Field              <span class="operator">|</span> Type          <span class="operator">|</span> <span class="keyword">Null</span> <span class="operator">|</span> Key <span class="operator">|</span> <span class="keyword">Default</span> <span class="operator">|</span> Extra <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">--------------------+---------------+------+-----+---------+-------+</span></span><br><span class="line"><span class="operator">|</span> productCode        <span class="operator">|</span> <span class="type">varchar</span>(<span class="number">15</span>)   <span class="operator">|</span> <span class="keyword">NO</span>   <span class="operator">|</span> PRI <span class="operator">|</span>         <span class="operator">|</span>       <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> productName        <span class="operator">|</span> <span class="type">varchar</span>(<span class="number">70</span>)   <span class="operator">|</span> <span class="keyword">NO</span>   <span class="operator">|</span>     <span class="operator">|</span> <span class="keyword">NULL</span>    <span class="operator">|</span>       <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> productLine        <span class="operator">|</span> <span class="type">varchar</span>(<span class="number">50</span>)   <span class="operator">|</span> <span class="keyword">NO</span>   <span class="operator">|</span> MUL <span class="operator">|</span> <span class="keyword">NULL</span>    <span class="operator">|</span>       <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> productScale       <span class="operator">|</span> <span class="type">varchar</span>(<span class="number">10</span>)   <span class="operator">|</span> <span class="keyword">NO</span>   <span class="operator">|</span>     <span class="operator">|</span> <span class="keyword">NULL</span>    <span class="operator">|</span>       <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> productVendor      <span class="operator">|</span> <span class="type">varchar</span>(<span class="number">50</span>)   <span class="operator">|</span> <span class="keyword">NO</span>   <span class="operator">|</span>     <span class="operator">|</span> <span class="keyword">NULL</span>    <span class="operator">|</span>       <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> productDescription <span class="operator">|</span> text          <span class="operator">|</span> <span class="keyword">NO</span>   <span class="operator">|</span>     <span class="operator">|</span> <span class="keyword">NULL</span>    <span class="operator">|</span>       <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> quantityInStock    <span class="operator">|</span> <span class="type">smallint</span>(<span class="number">6</span>)   <span class="operator">|</span> <span class="keyword">NO</span>   <span class="operator">|</span>     <span class="operator">|</span> <span class="keyword">NULL</span>    <span class="operator">|</span>       <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> buyPrice           <span class="operator">|</span> <span class="type">decimal</span>(<span class="number">10</span>,<span class="number">2</span>) <span class="operator">|</span> <span class="keyword">NO</span>   <span class="operator">|</span>     <span class="operator">|</span> <span class="keyword">NULL</span>    <span class="operator">|</span>       <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> MSRP               <span class="operator">|</span> <span class="type">decimal</span>(<span class="number">10</span>,<span class="number">2</span>) <span class="operator">|</span> <span class="keyword">NO</span>   <span class="operator">|</span>     <span class="operator">|</span> <span class="keyword">NULL</span>    <span class="operator">|</span>       <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">--------------------+---------------+------+-----+---------+-------+</span></span><br><span class="line"><span class="number">9</span> <span class="keyword">rows</span> <span class="keyword">in</span> <span class="keyword">set</span></span><br></pre></td></tr></table></figure>

<p>使用<code>quantityInStock</code>和<code>buyPrice</code>列的数据，通过以下表达式计算每个<code>SKU</code>的股票值：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">quantityInStock <span class="operator">*</span> buyPrice</span><br></pre></td></tr></table></figure>

<p>但是，可以使用以下<a target="_blank" rel="noopener" href="http://www.yiibai.com/mysql/add-column.html" title="ALTER TABLE ... ADD COLUMN">ALTER TABLE … ADD COLUMN</a>语句将名为<code>stock_value</code>的存储的生成列添加到<code>products</code>表：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> products</span><br><span class="line"><span class="keyword">ADD</span> <span class="keyword">COLUMN</span> stockValue <span class="keyword">DOUBLE</span> </span><br><span class="line">GENERATED ALWAYS <span class="keyword">AS</span> (buyprice<span class="operator">*</span>quantityinstock) STORED;</span><br></pre></td></tr></table></figure>

<p>通常，<code>ALTER TABLE</code>语句需要完整的表重建，因此，如果更改大表是耗时的。 但是，虚拟列并非如此。</p>
<p>现在，我们可以直接从<code>products</code>表中查询库存值。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> </span><br><span class="line">    productName, ROUND(stockValue, <span class="number">2</span>) <span class="keyword">AS</span> stock_value</span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">    products;</span><br></pre></td></tr></table></figure>

<p>执行上面查询语句，得到以下结果 -</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">+---------------------------------------------+-------------+</span><br><span class="line">| productName                                 | stock_value |</span><br><span class="line">+---------------------------------------------+-------------+</span><br><span class="line">| 1969 Harley Davidson Ultimate Chopper       |   387209.73 |</span><br><span class="line">| 1952 Alpine Renault 1300                    |   720126.90 |</span><br><span class="line">| 1996 Moto Guzzi 1100i                       |   457058.75 |</span><br><span class="line">| 2003 Harley-Davidson Eagle Drag Bike        |   508073.64 |</span><br><span class="line">| 1972 Alfa Romeo GTA                         |   278631.36 |</span><br><span class="line">| 1962 LanciaA Delta 16V                      |   702325.22 |</span><br><span class="line">| 1968 Ford Mustang                           |     6483.12 |</span><br><span class="line">|************** 省略了一大波数据 ****************************|</span><br><span class="line">| The Queen Mary                              |   272869.44 |</span><br><span class="line">| American Airlines: MD-11S                   |   319901.40 |</span><br><span class="line">| Boeing X-32A JSF                            |   159163.89 |</span><br><span class="line">| Pont Yacht                                  |    13786.20 |</span><br><span class="line">+---------------------------------------------+-------------+</span><br><span class="line">110 rows in set</span><br></pre></td></tr></table></figure>

<p>参考： <a target="_blank" rel="noopener" href="https://www.yiibai.com/mysql/generated-columns.html">MySQL生成列 - MySQL教程 (yiibai.com)</a></p>
<h1 id="常见错误处理"><a href="#常见错误处理" class="headerlink" title="常见错误处理"></a>常见错误处理</h1><h2 id="Operation-CREATE-USER-failed-for-XXX"><a href="#Operation-CREATE-USER-failed-for-XXX" class="headerlink" title="Operation CREATE USER failed for XXX"></a>Operation CREATE USER failed for XXX</h2><p>原因：可能是执行了如下操作</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">delete</span>  <span class="keyword">from</span>  mysql.user  <span class="keyword">where</span> <span class="keyword">user</span> <span class="operator">=</span><span class="string">&#x27;user_1&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p>需要再执行下面命令</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">drop</span> <span class="keyword">user</span> user1;</span><br></pre></td></tr></table></figure>

<h2 id="ERROR-1269-HY000-Can’t-revoke-all-privileges-for-one-or-more-of-the-requested-users"><a href="#ERROR-1269-HY000-Can’t-revoke-all-privileges-for-one-or-more-of-the-requested-users" class="headerlink" title="ERROR 1269 (HY000): Can’t revoke all privileges for one or more of the requested users"></a>ERROR 1269 (HY000): Can’t revoke all privileges for one or more of the requested users</h2><p>需要加上host，例如</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">REVOKE</span> <span class="keyword">ALL</span> PRIVILEGES <span class="keyword">ON</span> <span class="operator">*</span>.<span class="operator">*</span> <span class="keyword">FROM</span> <span class="string">&#x27;testuser&#x27;</span>@<span class="string">&#x27;localhost&#x27;</span>;</span><br></pre></td></tr></table></figure>

<h2 id="字符校对规则问题"><a href="#字符校对规则问题" class="headerlink" title="字符校对规则问题"></a>字符校对规则问题</h2><p>查询视图时报错：java.sql.SQLException: Illegal mix of collations (utf8mb4_general_ci,IMPLICIT) and (utf8mb4_0900_ai_ci,IMPLICIT) for operation ‘&#x3D;’；</p>
<p>本地环境:<code>mysql8.0.13</code></p>
<p>异常提示排序规则编码混乱，mysql8.0.1之后的默认COLLATE为utf8mb4_0900_ai_ci；</p>
<p>检查视图中所包含的表发现其中一个建表时 没有设置编码，并且其他的表设置的是 CHARSET&#x3D;utf8mb4 COLLATE&#x3D;utf8mb4_general_ci；因此导致混乱；</p>
<p>查看当前数据库的默认编码：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">mysql&gt; </span><span class="language-bash">show variables <span class="built_in">where</span> Variable_name like <span class="string">&#x27;collation%&#x27;</span>;</span></span><br></pre></td></tr></table></figure>


<p>查看各表编码：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">mysql&gt; </span><span class="language-bash">show create table ‘table_name’;</span></span><br></pre></td></tr></table></figure>
<p>解决方案给没有设置编码的表重新设置一下：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">mysql&gt; </span><span class="language-bash">alter table table_name default character <span class="built_in">set</span> utf8mb4 collate=utf8mb4_general_ci;</span></span><br></pre></td></tr></table></figure>


<p>这样设置只针对表的，但是表中字段未修改：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">mysql&gt; </span><span class="language-bash">ALTER TABLE table_name convert to CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci;</span></span><br></pre></td></tr></table></figure>

<p>修改完成以后，重新创建视图！！！！</p>
<h2 id="排序内存溢出问题"><a href="#排序内存溢出问题" class="headerlink" title="排序内存溢出问题"></a>排序内存溢出问题</h2><p>报错：<br><code>SQLSTATE[HY001]: Memory allocation error: 1038 Out of sort memory, consider increasing sort buffer size</code></p>
<p>找到mysql配置文件（我的是<code>/etc/mysql/mysql.conf.d/mysqld.cnf</code>）, 添加一行</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sort_buffer_size        = 16M</span><br></pre></td></tr></table></figure>
<p>重启数据库，报错继续加大</p>
<h2 id="数据类型相关"><a href="#数据类型相关" class="headerlink" title="数据类型相关"></a>数据类型相关</h2><p>记录datetime到毫秒<br>5.6 之后可以将字段类型设置为datetime(3), 其中的数字表示精度，三位精确到毫秒</p>
<h2 id="Incorrect-key-file-for-notes"><a href="#Incorrect-key-file-for-notes" class="headerlink" title="Incorrect key file for notes"></a>Incorrect key file for notes</h2><p>解决方案（目前使用myisam引擎）</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">optimize <span class="keyword">table</span> notes;</span><br></pre></td></tr></table></figure>
<p>如果不行就google一下</p>
<h2 id="不用密码登录"><a href="#不用密码登录" class="headerlink" title="不用密码登录"></a>不用密码登录</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/my.cnf</span><br></pre></td></tr></table></figure>

<p>在[mysqld]段后加一行</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">skip-grant-tables</span><br></pre></td></tr></table></figure>

<p>或者用这条命令运行</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/usr/bin/mysqld --skip-grant-tables</span><br></pre></td></tr></table></figure>

<p>重启mysql</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">/etc/init.d/mysql restart</span><br><span class="line">service mysql restart</span><br></pre></td></tr></table></figure>

<h2 id="修改validate-password-policy参数的值"><a href="#修改validate-password-policy参数的值" class="headerlink" title="修改validate_password_policy参数的值"></a>修改validate_password_policy参数的值</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">set global validate_password_policy=0;</span><br><span class="line">#validate_password_length(密码长度)参数默认为8，修改为需要长度</span><br><span class="line">set global validate_password_length=1;</span><br></pre></td></tr></table></figure>

<h2 id="mysqld命令"><a href="#mysqld命令" class="headerlink" title="mysqld命令"></a>mysqld命令</h2><p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/shymen/p/8850655.html">https://www.cnblogs.com/shymen/p/8850655.html</a></p>
<h2 id="utf8-unicode-ci与utf8-general-ci的区别"><a href="#utf8-unicode-ci与utf8-general-ci的区别" class="headerlink" title="utf8_unicode_ci与utf8_general_ci的区别"></a>utf8_unicode_ci与utf8_general_ci的区别</h2><p>当前，utf8_unicode_ci校对规则仅部分支持Unicode校对规则算法。一些字符还是不能支持。并且，不能完全支持组合的记号。这主要影响越南和俄罗斯的一些少数民族语言，如：Udmurt 、Tatar、Bashkir和Mari。</p>
<p>utf8_unicode_ci的最主要的特色是支持扩展，即当把一个字母看作与其它字母组合相等时。例如，在德语和一些其它语言中‘ß’等于‘ss’。</p>
<p>utf8_general_ci是一个遗留的 校对规则，不支持扩展。它仅能够在字符之间进行逐个比较。这意味着utf8_general_ci校对规则进行的比较速度很快，但是与使用utf8_unicode_ci的校对规则相比，比较正确性较差）。</p>
<p>例如，使用utf8_general_ci和utf8_unicode_ci两种 校对规则下面的比较相等：</p>
<p>Ä &#x3D; A</p>
<p>Ö &#x3D; O</p>
<p>Ü &#x3D; U</p>
<p>两种校对规则之间的区别是，对于utf8_general_ci下面的等式成立：</p>
<p>ß &#x3D; s</p>
<p>但是，对于utf8_unicode_ci下面等式成立：</p>
<p>ß &#x3D; ss</p>
<p>对于一种语言仅当使用utf8_unicode_ci排序做的不好时，才执行与具体语言相关的utf8字符集 校对规则。例如，对于德语和法语，utf8_unicode_ci工作的很好，因此不再需要为这两种语言创建特殊的utf8校对规则。</p>
<p>utf8_general_ci也适用与德语和法语，除了‘ß’等于‘s’，而不是‘ss’之外。如果你的应用能够接受这些，那么应该使用utf8_general_ci，因为它速度快。否则，使用utf8_unicode_ci，因为它比较准确。</p>
</div><div class="article-licensing box"><div class="licensing-title"><p>Mysql基础命令及语法笔记</p><p><a href="https://www.chengyao.xyz/2021/07/05/Mysql基础命令及语法笔记/">https://www.chengyao.xyz/2021/07/05/Mysql基础命令及语法笔记/</a></p></div><div class="licensing-meta level is-mobile"><div class="level-left"><div class="level-item is-narrow"><div><h6>作者</h6><p>CY</p></div></div><div class="level-item is-narrow"><div><h6>发布于</h6><p>2021-07-05</p></div></div><div class="level-item is-narrow"><div><h6>更新于</h6><p>2022-10-02</p></div></div><div class="level-item is-narrow"><div><h6>许可协议</h6><p><a class="icons" rel="noopener" target="_blank" title="Creative Commons" href="https://creativecommons.org/"><i class="icon fab fa-creative-commons"></i></a><a class="icons" rel="noopener" target="_blank" title="Attribution" href="https://creativecommons.org/licenses/by/4.0/"><i class="icon fab fa-creative-commons-by"></i></a><a class="icons" rel="noopener" target="_blank" title="Noncommercial" href="https://creativecommons.org/licenses/by-nc/4.0/"><i class="icon fab fa-creative-commons-nc"></i></a></p></div></div></div></div></div><div class="sharethis-inline-share-buttons"></div><script src="https://www.chengyao.xyz" defer></script></article></div><div class="card"><div class="card-content"><h3 class="menu-label has-text-centered">喜欢这篇文章？打赏一下作者吧</h3><div class="buttons is-centered"><a class="button donate" data-type="alipay"><span class="icon is-small"><i class="fab fa-alipay"></i></span><span>支付宝</span><span class="qrcode"><img src="/images/alipay.jpg" alt="支付宝"></span></a><a class="button donate" data-type="wechat"><span class="icon is-small"><i class="fab fa-weixin"></i></span><span>微信</span><span class="qrcode"><img src="/images/wechat.png" alt="微信"></span></a></div></div></div><nav class="post-navigation mt-4 level is-mobile"><div class="level-start"><a class="article-nav-prev level level-item link-muted" href="/2021/07/06/SQL%E4%BC%98%E5%8C%96%E7%9B%B8%E5%85%B3%E6%80%BB%E7%BB%93/"><i class="level-item fas fa-chevron-left"></i><span class="level-item">SQL优化相关总结</span></a></div><div class="level-end"><a class="article-nav-next level level-item link-muted" href="/2021/07/02/%E6%9F%A5%E7%9C%8Bmysql%E6%95%B0%E6%8D%AE%E5%BA%93%E5%AE%B9%E9%87%8F%E5%A4%A7%E5%B0%8F/"><span class="level-item">查看mysql数据库容量大小</span><i class="level-item fas fa-chevron-right"></i></a></div></nav><div class="card"><div class="card-content"><h3 class="title is-5">评论</h3><div class="notification is-danger">You forgot to set the <code>shortname</code> for Disqus. Please set it in <code>_config.yml</code>.</div></div></div></div><div class="column column-left is-4-tablet is-4-desktop is-3-widescreen  order-1 is-sticky"><div class="card widget" data-type="profile"><div class="card-content"><nav class="level"><div class="level-item has-text-centered flex-shrink-1"><div><figure class="image is-128x128 mx-auto mb-2"><img class="avatar" src="/images/avatar.jpg" alt="程"></figure><p class="title is-size-4 is-block" style="line-height:inherit;">程</p><p class="is-size-6 is-block">未至精疲力尽，不要怨天尤人。昨日因，今日果。今日为，明日果！</p><p class="is-size-6 is-flex justify-content-center"><i class="fas fa-map-marker-alt mr-1"></i><span>Earth</span></p></div></div></nav><nav class="level is-mobile"><div class="level-item has-text-centered is-marginless"><div><p class="heading">文章</p><a href="/archives"><p class="title">168</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">分类</p><a href="/categories"><p class="title">0</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">标签</p><a href="/tags"><p class="title">0</p></a></div></div></nav><div class="level"><a class="level-item button is-primary is-rounded" href="https://github.com/tab-engineer" target="_blank" rel="noopener">关注我</a></div><div class="level is-mobile is-multiline"><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Github" href="https://github.com/tab-engineer"><i class="fab fa-github"></i></a></div></div></div><div class="card widget" data-type="links"><div class="card-content"><div class="menu"><h3 class="menu-label">链接</h3><ul class="menu-list"><li><a class="level is-mobile" href="https://github.com/marxphp" target="_blank" rel="noopener"><span class="level-left"><span class="level-item">maxphp</span></span><span class="level-right"><span class="level-item tag">github.com</span></span></a></li></ul></div></div></div><div class="column-right-shadow is-hidden-widescreen"></div></div><div class="column column-right is-4-tablet is-4-desktop is-3-widescreen is-hidden-touch is-hidden-desktop-only order-3"><!--!--><!--!--><!--!--><div class="card widget" data-type="recent-posts"><div class="card-content"><h3 class="menu-label">最新文章</h3><article class="media"><div class="media-content"><p class="date"><time dateTime="2022-10-01T06:56:20.000Z">2022-10-01</time></p><p class="title"><a href="/2022/10/01/tcpdump%E8%AF%A6%E7%BB%86%E6%95%99%E7%A8%8B/">tcpdump详细教程</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2022-09-18T05:06:34.000Z">2022-09-18</time></p><p class="title"><a href="/2022/09/18/Typescript%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/">Typescript学习笔记</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2022-09-04T13:30:39.000Z">2022-09-04</time></p><p class="title"><a href="/2022/09/04/Go%E5%90%84%E6%97%B6%E9%97%B4%E5%AD%97%E7%AC%A6%E4%B8%B2%E7%9A%84%E8%A7%A3%E6%9E%90/">Go各时间字符串的解析</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2022-08-21T02:56:27.000Z">2022-08-21</time></p><p class="title"><a href="/2022/08/21/%E7%89%88%E6%9C%AC%E5%8F%B7%E5%91%BD%E5%90%8D%E8%A7%84%E8%8C%83/">版本号命名规范</a></p></div></article><article class="media"><div class="media-content"><p class="date"><time dateTime="2022-08-19T12:54:39.000Z">2022-08-19</time></p><p class="title"><a href="/2022/08/19/Markdown%E5%9F%BA%E6%9C%AC%E8%AF%AD%E6%B3%95/">Markdown基本语法</a></p></div></article></div></div></div></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/"><img src="/images/avatar.jpg" alt="笔记" height="28"></a><p class="is-size-7"><span>&copy; 2022 CY</span>  Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a> &amp; <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="noopener">Icarus</a></p></div><div class="level-end"><div class="field has-addons"><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Attribution 4.0 International" href="https://creativecommons.org/licenses/by/4.0/"><i class="fab fa-creative-commons-by"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/ppoffice/hexo-theme-icarus"><i class="fab fa-github"></i></a></p></div></div></div></div></footer><script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script><script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script><script>moment.locale("zh-CN");</script><script>var IcarusThemeSettings = {
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script src="/js/column.js"></script><script src="/js/animation.js"></script><a id="back-to-top" title="回到顶端" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script src="/js/back_to_top.js" defer></script><!--!--><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.js" defer></script><script>window.addEventListener("load", () => {
      window.cookieconsent.initialise({
        type: "info",
        theme: "edgeless",
        static: false,
        position: "bottom-left",
        content: {
          message: "此网站使用Cookie来改善您的体验。",
          dismiss: "知道了！",
          allow: "允许使用Cookie",
          deny: "拒绝",
          link: "了解更多",
          policy: "Cookie政策",
          href: "https://www.cookiesandyou.com/",
        },
        palette: {
          popup: {
            background: "#edeff5",
            text: "#838391"
          },
          button: {
            background: "#4b81e8"
          },
        },
      });
    });</script><script src="https://cdn.jsdelivr.net/npm/lightgallery@1.10.0/dist/js/lightgallery.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.8.1/dist/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><!--!--><!--!--><!--!--><!--!--><!--!--><script src="/js/main.js" defer></script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="想要查找什么..."></div><a class="searchbox-close" href="javascript:;">×</a></div><div class="searchbox-body"></div></div></div><script src="/js/insight.js" defer></script><script>document.addEventListener('DOMContentLoaded', function () {
            loadInsight({"contentUrl":"/content.json"}, {"hint":"想要查找什么...","untitled":"(无标题)","posts":"文章","pages":"页面","categories":"分类","tags":"标签"});
        });</script></body></html>